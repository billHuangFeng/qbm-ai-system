# æ•°æ®å¯¼å…¥åˆ†é˜¶æ®µç­–ç•¥åˆ†æž

**åˆ›å»ºæ—¶é—´**: 2025-01-23  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… **åˆ†æžå®Œæˆ**

---

## ðŸ“‹ æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆAï¼šå•é˜¶æ®µå¯¼å…¥ï¼ˆç›´æŽ¥å¯¼å…¥æ­£å¼è¡¨ï¼‰

**æµç¨‹**ï¼š
```
1. æ•°æ®åŽ»é‡
2. ç›´æŽ¥å¯¼å…¥æ­£å¼è¡¨
3. åœ¨æ­£å¼è¡¨ä¸­è¡¥å……ç¼ºå¤±å­—æ®µï¼ˆä¸»æ•°æ®åŒ¹é…ã€ç”¨æˆ·å†³ç­–ç­‰ï¼‰
```

### æ–¹æ¡ˆBï¼šä¸¤é˜¶æ®µå¯¼å…¥ï¼ˆä¸´æ—¶è¡¨ â†’ æ­£å¼è¡¨ï¼‰

**æµç¨‹**ï¼š
```
1. å¯¼å…¥ä¸´æ—¶è¡¨ï¼ˆstaging tableï¼‰
2. åœ¨ä¸´æ—¶è¡¨ä¸­è¡¥å……ç¼ºå¤±å­—æ®µï¼ˆä¸»æ•°æ®åŒ¹é…ã€ç”¨æˆ·å†³ç­–ç­‰ï¼‰
3. æ•°æ®éªŒè¯å’Œä¿®æ­£
4. å¯¼å…¥æ­£å¼è¡¨
```

---

## ðŸ“Š è¯¦ç»†å¯¹æ¯”åˆ†æž

### 1. æ•°æ®ä¸€è‡´æ€§å’Œå®‰å…¨æ€§

| ç»´åº¦ | å•é˜¶æ®µå¯¼å…¥ | ä¸¤é˜¶æ®µå¯¼å…¥ | ä¼˜åŠ¿æ–¹ |
|------|-----------|-----------|--------|
| **æ•°æ®éš”ç¦»** | âŒ å¯¼å…¥çš„æ•°æ®ç›´æŽ¥è¿›å…¥æ­£å¼è¡¨ï¼Œå¯èƒ½å½±å“ä¸šåŠ¡ | âœ… ä¸´æ—¶è¡¨éš”ç¦»ï¼Œä¸å½±å“æ­£å¼æ•°æ® | **ä¸¤é˜¶æ®µ** |
| **é”™è¯¯æ•°æ®å½±å“** | âŒ é”™è¯¯æ•°æ®å¯èƒ½å½±å“æ­£å¼è¡¨ï¼Œéš¾ä»¥å›žæ»š | âœ… é”™è¯¯æ•°æ®åœç•™åœ¨ä¸´æ—¶è¡¨ï¼Œä¸ä¼šå½±å“æ­£å¼è¡¨ | **ä¸¤é˜¶æ®µ** |
| **äº‹åŠ¡å®Œæ•´æ€§** | âš ï¸ è¡¥å……è¿‡ç¨‹è¾ƒé•¿ï¼Œäº‹åŠ¡å¯èƒ½è¶…æ—¶ | âœ… åˆ†é˜¶æ®µå¤„ç†ï¼Œäº‹åŠ¡æŽ§åˆ¶æ›´çµæ´» | **ä¸¤é˜¶æ®µ** |
| **æ•°æ®è¿½æº¯** | âš ï¸ éœ€è¦é¢å¤–æœºåˆ¶è®°å½•åŽŸå§‹æ•°æ® | âœ… ä¸´æ—¶è¡¨ä¿ç•™åŽŸå§‹æ•°æ®ï¼Œä¾¿äºŽè¿½æº¯ | **ä¸¤é˜¶æ®µ** |

**ç»“è®º**ï¼šä¸¤é˜¶æ®µå¯¼å…¥åœ¨æ•°æ®ä¸€è‡´æ€§å’Œå®‰å…¨æ€§æ–¹é¢æœ‰æ˜Žæ˜¾ä¼˜åŠ¿ã€‚

---

### 2. é”™è¯¯å¤„ç†å’Œä¿®æ­£èƒ½åŠ›

| ç»´åº¦ | å•é˜¶æ®µå¯¼å…¥ | ä¸¤é˜¶æ®µå¯¼å…¥ | ä¼˜åŠ¿æ–¹ |
|------|-----------|-----------|--------|
| **æ‰¹é‡ä¿®æ­£** | âŒ éœ€è¦æ›´æ–°æ­£å¼è¡¨ï¼Œå¯èƒ½å½±å“å·²ä½¿ç”¨çš„æ•°æ® | âœ… åœ¨ä¸´æ—¶è¡¨ä¸­æ‰¹é‡ä¿®æ­£ï¼Œä¸å½±å“æ­£å¼è¡¨ | **ä¸¤é˜¶æ®µ** |
| **é”™è¯¯å›žæ»š** | âŒ å·²å¯¼å…¥æ­£å¼è¡¨çš„æ•°æ®éš¾ä»¥å›žæ»š | âœ… å¯ä»¥è½»æ¾åˆ é™¤æˆ–ä¿®æ”¹ä¸´æ—¶è¡¨ä¸­çš„æ•°æ® | **ä¸¤é˜¶æ®µ** |
| **é—®é¢˜è®°å½•** | âš ï¸ éœ€è¦é¢å¤–çš„é—®é¢˜è¿½è¸ªè¡¨ | âœ… ä¸´æ—¶è¡¨æœ¬èº«å°±æ˜¯é—®é¢˜è®°å½•è½½ä½“ | **ä¸¤é˜¶æ®µ** |
| **æ¸è¿›å¼ä¿®æ­£** | âŒ ä¿®æ­£è¿‡ç¨‹å¯èƒ½å½±å“å…¶ä»–ç”¨æˆ· | âœ… ä¿®æ­£è¿‡ç¨‹ä¸å½±å“æ­£å¼æ•°æ® | **ä¸¤é˜¶æ®µ** |

**ç»“è®º**ï¼šä¸¤é˜¶æ®µå¯¼å…¥åœ¨é”™è¯¯å¤„ç†å’Œä¿®æ­£æ–¹é¢æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚

---

### 3. ç”¨æˆ·æ“ä½œä½“éªŒ

| ç»´åº¦ | å•é˜¶æ®µå¯¼å…¥ | ä¸¤é˜¶æ®µå¯¼å…¥ | ä¼˜åŠ¿æ–¹ |
|------|-----------|-----------|--------|
| **å³æ—¶åé¦ˆ** | âœ… å¯¼å…¥åŽç«‹å³å¯ä»¥çœ‹åˆ°æ•°æ® | âš ï¸ éœ€è¦ç­‰å¾…ä¸¤é˜¶æ®µå®Œæˆæ‰èƒ½çœ‹åˆ° | **å•é˜¶æ®µ** |
| **æ“ä½œå¤æ‚åº¦** | âœ… ä¸€æ­¥åˆ°ä½ï¼Œæ“ä½œç®€å• | âš ï¸ éœ€è¦ä¸¤æ¬¡æ“ä½œï¼ˆå¯¼å…¥+ç¡®è®¤å¯¼å…¥ï¼‰ | **å•é˜¶æ®µ** |
| **é—®é¢˜å¤„ç†** | âŒ éœ€è¦åœ¨æ­£å¼è¡¨ä¸­å¤„ç†é—®é¢˜æ•°æ® | âœ… å¯ä»¥åœ¨ä¸´æ—¶è¡¨ä¸­é›†ä¸­å¤„ç†é—®é¢˜ | **ä¸¤é˜¶æ®µ** |
| **æ‰¹é‡ç¡®è®¤** | âŒ éš¾ä»¥æ‰¹é‡å¤„ç†é—®é¢˜æ•°æ® | âœ… å¯ä»¥æ‰¹é‡ç¡®è®¤ã€ä¿®æ­£ã€åºŸå¼ƒ | **ä¸¤é˜¶æ®µ** |
| **é¢„è§ˆå’ŒéªŒè¯** | âŒ å¯¼å…¥å‰éš¾ä»¥é¢„è§ˆæ•°æ®è´¨é‡ | âœ… å¯ä»¥åœ¨ä¸´æ—¶è¡¨ä¸­é¢„è§ˆå’ŒéªŒè¯ | **ä¸¤é˜¶æ®µ** |

**ç»“è®º**ï¼šç”¨æˆ·ä½“éªŒæ–¹é¢å„æœ‰ä¼˜åŠ¿ï¼Œå•é˜¶æ®µæ›´ç®€å•ï¼Œä¸¤é˜¶æ®µæ›´çµæ´»ã€‚

---

### 4. æ€§èƒ½å’Œèµ„æºæ¶ˆè€—

| ç»´åº¦ | å•é˜¶æ®µå¯¼å…¥ | ä¸¤é˜¶æ®µå¯¼å…¥ | ä¼˜åŠ¿æ–¹ |
|------|-----------|-----------|--------|
| **å¯¼å…¥é€Ÿåº¦** | âœ… ä¸€æ¬¡å¯¼å…¥ï¼Œé€Ÿåº¦æ›´å¿« | âš ï¸ éœ€è¦ä¸¤æ¬¡å†™å…¥ï¼Œé€Ÿåº¦ç¨æ…¢ | **å•é˜¶æ®µ** |
| **å­˜å‚¨å¼€é”€** | âœ… æ— éœ€ä¸´æ—¶è¡¨ï¼Œå­˜å‚¨å¼€é”€å° | âš ï¸ éœ€è¦ä¸´æ—¶è¡¨å­˜å‚¨ï¼Œé¢å¤–å¼€é”€ | **å•é˜¶æ®µ** |
| **æ•°æ®åº“è´Ÿè½½** | âš ï¸ ç›´æŽ¥æ“ä½œæ­£å¼è¡¨ï¼Œå¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½ | âœ… ä¸´æ—¶è¡¨æ“ä½œä¸å½±å“æ­£å¼è¡¨æ€§èƒ½ | **ä¸¤é˜¶æ®µ** |
| **é”ç«žäº‰** | âŒ æ­£å¼è¡¨å¯èƒ½æœ‰é”ç«žäº‰ | âœ… ä¸´æ—¶è¡¨é”ç«žäº‰å° | **ä¸¤é˜¶æ®µ** |
| **æ‰¹é‡å¤„ç†** | âš ï¸ å¤§æ–‡ä»¶å¤„ç†å¯èƒ½é˜»å¡ž | âœ… å¯ä»¥åœ¨ä¸´æ—¶è¡¨ä¸­åˆ†æ‰¹å¤„ç† | **ä¸¤é˜¶æ®µ** |

**ç»“è®º**ï¼šæ€§èƒ½æ–¹é¢ï¼Œå•é˜¶æ®µå¯¼å…¥é€Ÿåº¦æ›´å¿«ï¼Œä½†ä¸¤é˜¶æ®µå¯¼å…¥å¯¹ç³»ç»Ÿè´Ÿè½½æ›´å‹å¥½ã€‚

---

### 5. ä¸šåŠ¡æµç¨‹é€‚é…

| ç»´åº¦ | å•é˜¶æ®µå¯¼å…¥ | ä¸¤é˜¶æ®µå¯¼å…¥ | ä¼˜åŠ¿æ–¹ |
|------|-----------|-----------|--------|
| **å®¡æ ¸æµç¨‹** | âŒ å¯¼å…¥åŽéš¾ä»¥å®¡æ ¸ | âœ… å¯ä»¥åœ¨ä¸´æ—¶è¡¨ä¸­å®¡æ ¸åŽå†å¯¼å…¥ | **ä¸¤é˜¶æ®µ** |
| **æ•°æ®è´¨é‡ä¿è¯** | âŒ ä½Žè´¨é‡æ•°æ®å¯èƒ½è¿›å…¥æ­£å¼è¡¨ | âœ… å¯ä»¥åœ¨ä¸´æ—¶è¡¨ä¸­éªŒè¯è´¨é‡åŽå†å¯¼å…¥ | **ä¸¤é˜¶æ®µ** |
| **åä½œå¤„ç†** | âŒ å¤šç”¨æˆ·åŒæ—¶ä¿®æ­£å¯èƒ½å†²çª | âœ… å¯ä»¥åœ¨ä¸´æ—¶è¡¨ä¸­åä½œå¤„ç†é—®é¢˜ | **ä¸¤é˜¶æ®µ** |
| **åŽ†å²è®°å½•** | âš ï¸ éœ€è¦é¢å¤–è®°å½•å¯¼å…¥åŽ†å² | âœ… ä¸´æ—¶è¡¨æœ¬èº«è®°å½•å¯¼å…¥æ‰¹æ¬¡ | **ä¸¤é˜¶æ®µ** |
| **å¢žé‡å¯¼å…¥** | âœ… ç®€å•ç›´æŽ¥ | âš ï¸ éœ€è¦é¢å¤–é€»è¾‘å¤„ç†å¢žé‡ | **å•é˜¶æ®µ** |

**ç»“è®º**ï¼šä¸šåŠ¡æµç¨‹æ–¹é¢ï¼Œä¸¤é˜¶æ®µå¯¼å…¥æ›´é€‚åˆéœ€è¦å®¡æ ¸å’Œåä½œçš„åœºæ™¯ã€‚

---

### 6. æŠ€æœ¯å¤æ‚åº¦

| ç»´åº¦ | å•é˜¶æ®µå¯¼å…¥ | ä¸¤é˜¶æ®µå¯¼å…¥ | ä¼˜åŠ¿æ–¹ |
|------|-----------|-----------|--------|
| **å®žçŽ°å¤æ‚åº¦** | âœ… å®žçŽ°ç®€å•ï¼Œé€»è¾‘ç›´æŽ¥ | âš ï¸ éœ€è¦ç®¡ç†ä¸´æ—¶è¡¨å’Œä¸¤é˜¶æ®µæµç¨‹ | **å•é˜¶æ®µ** |
| **ç»´æŠ¤æˆæœ¬** | âœ… ç»´æŠ¤ç®€å• | âš ï¸ éœ€è¦ç»´æŠ¤ä¸´æ—¶è¡¨å’Œæ¸…ç†é€»è¾‘ | **å•é˜¶æ®µ** |
| **è°ƒè¯•éš¾åº¦** | âœ… æµç¨‹ç®€å•ï¼Œæ˜“äºŽè°ƒè¯• | âš ï¸ ä¸¤é˜¶æ®µæµç¨‹ï¼Œè°ƒè¯•æ›´å¤æ‚ | **å•é˜¶æ®µ** |
| **æ‰©å±•æ€§** | âš ï¸ æ‰©å±•åŠŸèƒ½å¯èƒ½éœ€è¦ä¿®æ”¹æ­£å¼è¡¨ | âœ… ä¸´æ—¶è¡¨å¯ä»¥çµæ´»æ‰©å±• | **ä¸¤é˜¶æ®µ** |

**ç»“è®º**ï¼šæŠ€æœ¯å¤æ‚åº¦æ–¹é¢ï¼Œå•é˜¶æ®µå¯¼å…¥æ›´ç®€å•ã€‚

---

## ðŸŽ¯ ç»¼åˆåˆ†æžç»“è®º

### æŽ¨èæ–¹æ¡ˆï¼š**ä¸¤é˜¶æ®µå¯¼å…¥**

**ç†ç”±**ï¼š

1. âœ… **æ•°æ®å®‰å…¨**ï¼šä¸¤é˜¶æ®µå¯¼å…¥èƒ½æœ‰æ•ˆéš”ç¦»é”™è¯¯æ•°æ®ï¼Œé¿å…å½±å“æ­£å¼ä¸šåŠ¡æ•°æ®
2. âœ… **é”™è¯¯å¤„ç†**ï¼šåœ¨ä¸´æ—¶è¡¨ä¸­æ‰¹é‡ä¿®æ­£é—®é¢˜ï¼Œæ›´çµæ´»ã€æ›´å®‰å…¨
3. âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šè™½ç„¶éœ€è¦ä¸¤æ­¥æ“ä½œï¼Œä½†å¯ä»¥åœ¨ä¸´æ—¶è¡¨ä¸­é¢„è§ˆå’ŒéªŒè¯ï¼Œæé«˜æ•°æ®è´¨é‡
4. âœ… **ä¸šåŠ¡æµç¨‹**ï¼šé€‚åˆéœ€è¦å®¡æ ¸ã€åä½œçš„ä¸šåŠ¡åœºæ™¯
5. âœ… **ç³»ç»Ÿæ€§èƒ½**ï¼šå‡å°‘æ­£å¼è¡¨çš„å†™æ“ä½œå’Œé”ç«žäº‰

**ä½†éœ€è¦ä¼˜åŒ–**ï¼š

1. **ç®€åŒ–æ“ä½œæµç¨‹**ï¼šæä¾›"ä¸€é”®ç¡®è®¤å¯¼å…¥"åŠŸèƒ½ï¼Œå‡å°‘ç”¨æˆ·æ“ä½œæ­¥éª¤
2. **è‡ªåŠ¨æ¸…ç†**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸä¸´æ—¶è¡¨æ•°æ®ï¼Œå‡å°‘å­˜å‚¨å¼€é”€
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¼˜åŒ–ä¸´æ—¶è¡¨åˆ°æ­£å¼è¡¨çš„å¯¼å…¥æ€§èƒ½

---

## ðŸ“ ä¸¤é˜¶æ®µå¯¼å…¥è¯¦ç»†è®¾è®¡

### é˜¶æ®µ1ï¼šå¯¼å…¥ä¸´æ—¶è¡¨ï¼ˆStaging Tableï¼‰

**ç›®æ ‡**ï¼š
- å¿«é€ŸæŽ¥æ”¶å¯¼å…¥æ•°æ®
- ä¿ç•™åŽŸå§‹æ•°æ®
- è®°å½•å¯¼å…¥æ‰¹æ¬¡ä¿¡æ¯
- æ ‡è®°é—®é¢˜æ•°æ®

**æ•°æ®ç»“æž„**ï¼š
```sql
CREATE TABLE staging_document_import (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    
    -- å¯¼å…¥æ‰¹æ¬¡ä¿¡æ¯
    batch_id UUID NOT NULL,                    -- å¯¼å…¥æ‰¹æ¬¡ID
    import_user_id UUID,                        -- å¯¼å…¥ç”¨æˆ·ID
    import_source VARCHAR(100),                 -- æ•°æ®æº
    import_file_name VARCHAR(255),              -- æºæ–‡ä»¶å
    import_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- å¯¼å…¥æ—¶é—´
    
    -- æ•°æ®å­—æ®µï¼ˆåŽŸå§‹æ•°æ®ï¼‰
    document_number VARCHAR(100),               -- å•æ®å·ï¼ˆåŽŸå§‹ï¼‰
    document_date DATE,                         -- å•æ®æ—¥æœŸï¼ˆåŽŸå§‹ï¼‰
    customer_name VARCHAR(255),                 -- å®¢æˆ·åç§°ï¼ˆåŽŸå§‹ï¼‰
    product_name VARCHAR(255),                  -- äº§å“åç§°ï¼ˆåŽŸå§‹ï¼‰
    quantity DECIMAL(18,2),                      -- æ•°é‡ï¼ˆåŽŸå§‹ï¼‰
    unit_price DECIMAL(18,2),                   -- å•ä»·ï¼ˆåŽŸå§‹ï¼‰
    amount_excluding_tax DECIMAL(18,2),        -- ä¸å«ç¨Žé‡‘é¢ï¼ˆåŽŸå§‹ï¼‰
    tax_amount DECIMAL(18,2),                   -- ç¨Žé¢ï¼ˆåŽŸå§‹ï¼‰
    total_amount_with_tax DECIMAL(18,2),       -- ä»·ç¨Žåˆè®¡ï¼ˆåŽŸå§‹ï¼‰
    
    -- åŒ¹é…å’Œè¡¥å……åŽçš„å­—æ®µ
    business_entity_id UUID,                    -- ç»è¥ä¸»ä½“IDï¼ˆåŒ¹é…åŽï¼‰
    counterparty_id UUID,                       -- å¾€æ¥å•ä½IDï¼ˆåŒ¹é…åŽï¼‰
    product_id UUID,                            -- äº§å“IDï¼ˆåŒ¹é…åŽï¼‰
    unit_id UUID,                              -- è®¡é‡å•ä½IDï¼ˆåŒ¹é…åŽï¼‰
    tax_rate_id UUID,                          -- ç¨ŽçŽ‡IDï¼ˆåŒ¹é…åŽï¼‰
    employee_id UUID,                          -- å‘˜å·¥IDï¼ˆåŒ¹é…åŽï¼‰
    exchange_rate_id UUID,                      -- æ±‡çŽ‡IDï¼ˆåŒ¹é…åŽï¼‰
    document_header_id UUID,                   -- å•æ®å¤´IDï¼ˆæ ¼å¼5è¡¥å……æ˜Žç»†æ—¶ï¼‰
    
    -- é—®é¢˜æ ‡è®°å’ŒçŠ¶æ€
    status VARCHAR(50) DEFAULT 'pending',      -- çŠ¶æ€ï¼špending, matched, problem, confirmed, imported
    problem_type VARCHAR(50),                   -- é—®é¢˜ç±»åž‹ï¼šno_master_match, multiple_match, calculation_conflict, ...
    problem_description TEXT,                   -- é—®é¢˜æè¿°
    requires_user_action BOOLEAN DEFAULT FALSE, -- æ˜¯å¦éœ€è¦ç”¨æˆ·å¤„ç†
    
    -- ç”¨æˆ·å†³ç­–ä¿¡æ¯
    user_action VARCHAR(50),                    -- ç”¨æˆ·æ“ä½œï¼šselect, create_new, skip, fixed
    user_action_details JSONB,                 -- ç”¨æˆ·æ“ä½œè¯¦æƒ…ï¼ˆå¦‚é€‰æ‹©çš„IDã€åˆ›å»ºçš„æ–°è®°å½•ç­‰ï¼‰
    user_action_timestamp TIMESTAMP,           -- ç”¨æˆ·æ“ä½œæ—¶é—´
    handled_by_user_id UUID,                   -- å¤„ç†ç”¨æˆ·ID
    
    -- æ•°æ®è´¨é‡è¯„åˆ†
    quality_score DECIMAL(5,2),                -- æ•°æ®è´¨é‡è¯„åˆ†ï¼ˆ0-100ï¼‰
    validation_errors JSONB,                    -- éªŒè¯é”™è¯¯åˆ—è¡¨
    
    -- åŽŸå§‹è¡Œæ•°æ®ï¼ˆJSONæ ¼å¼ï¼Œä¿ç•™æ‰€æœ‰åŽŸå§‹å­—æ®µï¼‰
    raw_data_json JSONB,                       -- åŽŸå§‹æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰
    row_number INTEGER,                        -- æºæ–‡ä»¶è¡Œå·
    
    -- å…ƒæ•°æ®
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- ç´¢å¼•
    INDEX idx_staging_batch (batch_id),
    INDEX idx_staging_status (status),
    INDEX idx_staging_requires_action (requires_user_action),
    INDEX idx_staging_document_number (document_number)
);
```

### é˜¶æ®µ2ï¼šä¿®æ­£å’Œç¡®è®¤

**ç”¨æˆ·æ“ä½œç•Œé¢**ï¼š

1. **é—®é¢˜åˆ—è¡¨è§†å›¾**
   - æ˜¾ç¤ºæ‰€æœ‰éœ€è¦å¤„ç†çš„é—®é¢˜æ•°æ®
   - æŒ‰é—®é¢˜ç±»åž‹åˆ†ç»„ï¼ˆä¸»æ•°æ®åŒ¹é…ã€è®¡ç®—å†²çªç­‰ï¼‰
   - æ”¯æŒç­›é€‰å’Œæœç´¢

2. **æ‰¹é‡å¤„ç†åŠŸèƒ½**
   - æ‰¹é‡ç¡®è®¤æ¨¡ç³ŠåŒ¹é…
   - æ‰¹é‡åˆ›å»ºæ–°çš„ä¸»æ•°æ®è®°å½•
   - æ‰¹é‡åºŸå¼ƒè®°å½•
   - æ‰¹é‡ä¿®æ­£è®¡ç®—å­—æ®µå†²çª

3. **é€æ¡å¤„ç†åŠŸèƒ½**
   - æ˜¾ç¤ºåŽŸå§‹æ•°æ®å’ŒåŒ¹é…ç»“æžœ
   - ç”¨æˆ·é€‰æ‹©ã€åˆ›å»ºã€åºŸå¼ƒæ“ä½œ
   - å®žæ—¶é¢„è§ˆä¿®æ­£åŽçš„æ•°æ®

### é˜¶æ®µ3ï¼šå¯¼å…¥æ­£å¼è¡¨

**è§¦å‘æ¡ä»¶**ï¼š
- æ‰€æœ‰é—®é¢˜å·²å¤„ç†ï¼ˆstatus = 'confirmed'ï¼‰
- ç”¨æˆ·æ‰‹åŠ¨è§¦å‘"ç¡®è®¤å¯¼å…¥"
- å®šæ—¶æ‰¹é‡å¯¼å…¥ï¼ˆå¯é€‰ï¼‰

**å¯¼å…¥é€»è¾‘**ï¼š
```sql
-- 1. éªŒè¯æ•°æ®å®Œæ•´æ€§
-- 2. åŽ»é‡æ£€æŸ¥
-- 3. å¯¼å…¥æ­£å¼è¡¨
INSERT INTO doc_purchase_order_header (...)
SELECT ... FROM staging_document_import
WHERE batch_id = ? AND status = 'confirmed';

INSERT INTO doc_purchase_order_detail (...)
SELECT ... FROM staging_document_import
WHERE batch_id = ? AND status = 'confirmed';

-- 4. æ›´æ–°ä¸´æ—¶è¡¨çŠ¶æ€
UPDATE staging_document_import
SET status = 'imported', imported_at = CURRENT_TIMESTAMP
WHERE batch_id = ? AND status = 'confirmed';
```

---

## ðŸš€ ä¼˜åŒ–å»ºè®®

### 1. ç®€åŒ–ç”¨æˆ·æ“ä½œ

**ä¸€é”®å¯¼å…¥åŠŸèƒ½**ï¼š
```python
# è‡ªåŠ¨å¤„ç†é«˜ç½®ä¿¡åº¦åŒ¹é…ï¼Œç›´æŽ¥å¯¼å…¥æ­£å¼è¡¨
# åªå°†ä½Žç½®ä¿¡åº¦ã€éœ€è¦å†³ç­–çš„æ•°æ®å¯¼å…¥ä¸´æ—¶è¡¨

def smart_import(data, threshold=0.9):
    high_confidence = filter(lambda x: x.confidence >= threshold, data)
    low_confidence = filter(lambda x: x.confidence < threshold, data)
    
    # é«˜ç½®ä¿¡åº¦æ•°æ®ç›´æŽ¥å¯¼å…¥æ­£å¼è¡¨
    import_to_production(high_confidence)
    
    # ä½Žç½®ä¿¡åº¦æ•°æ®å¯¼å…¥ä¸´æ—¶è¡¨ï¼Œç­‰å¾…ç”¨æˆ·å¤„ç†
    import_to_staging(low_confidence)
```

### 2. è‡ªåŠ¨æ¸…ç†æœºåˆ¶

```sql
-- è‡ªåŠ¨æ¸…ç†7å¤©å‰çš„å·²å¯¼å…¥ä¸´æ—¶æ•°æ®
DELETE FROM staging_document_import
WHERE status = 'imported'
  AND imported_at < CURRENT_TIMESTAMP - INTERVAL '7 days';

-- è‡ªåŠ¨æ¸…ç†30å¤©å‰çš„åºŸå¼ƒæ•°æ®
DELETE FROM staging_document_import
WHERE status = 'rejected'
  AND updated_at < CURRENT_TIMESTAMP - INTERVAL '30 days';
```

### 3. æ€§èƒ½ä¼˜åŒ–

- **æ‰¹é‡æ“ä½œ**ï¼šä½¿ç”¨æ‰¹é‡INSERT/UPDATEï¼Œæé«˜æ€§èƒ½
- **ç´¢å¼•ä¼˜åŒ–**ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
- **åˆ†åŒºè¡¨**ï¼šå¦‚æžœæ•°æ®é‡å¤§ï¼Œè€ƒè™‘ä½¿ç”¨åˆ†åŒºè¡¨
- **å¼‚æ­¥å¤„ç†**ï¼šå¯¼å…¥è¿‡ç¨‹ä½¿ç”¨å¼‚æ­¥ä»»åŠ¡ï¼Œé¿å…é˜»å¡ž

---

## ðŸ“Š æœ€ç»ˆæŽ¨è

### âœ… **æŽ¨èä½¿ç”¨ä¸¤é˜¶æ®µå¯¼å…¥æ–¹æ¡ˆ**

**å®žæ–½å»ºè®®**ï¼š

1. **åŸºç¡€ç‰ˆæœ¬**ï¼šå®žçŽ°å®Œæ•´çš„ä¸¤é˜¶æ®µå¯¼å…¥æµç¨‹
   - ä¸´æ—¶è¡¨å­˜å‚¨
   - é—®é¢˜æ ‡è®°å’Œè·Ÿè¸ª
   - ç”¨æˆ·ä¿®æ­£ç•Œé¢
   - ç¡®è®¤å¯¼å…¥åŠŸèƒ½

2. **ä¼˜åŒ–ç‰ˆæœ¬**ï¼šç®€åŒ–ç”¨æˆ·æ“ä½œ
   - é«˜ç½®ä¿¡åº¦æ•°æ®è‡ªåŠ¨å¯¼å…¥æ­£å¼è¡¨
   - ä¸€é”®æ‰¹é‡å¤„ç†
   - è‡ªåŠ¨æ¸…ç†æœºåˆ¶

3. **é«˜çº§ç‰ˆæœ¬**ï¼šå¢žå¼ºåŠŸèƒ½
   - æ•°æ®è´¨é‡è¯„åˆ†
   - å¯¼å…¥åŽ†å²è¿½æº¯
   - åä½œå¤„ç†åŠŸèƒ½

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- [å¤æ‚å•æ®æ ¼å¼å¤„ç†](./COMPLEX_DOCUMENT_FORMAT_HANDLING.md)
- [æ™ºèƒ½å­—æ®µæ˜ å°„è®¾è®¡](./INTELLIGENT_FIELD_MAPPING_DESIGN.md)
- [åˆ†å·¥ç­–ç•¥æ–‡æ¡£](./COMPLEX_IMPORT_DIVISION_STRATEGY.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åŽæ›´æ–°**: 2025-01-23

