# èƒ½åŠ›ä»·å€¼è®¡ç®—å…¬å¼è®¾è®¡

## ğŸ“‹ ç®—æ³•æ¦‚è¿°

åŸºäºç”¨æˆ·æ¾„æ¸…ï¼Œèƒ½åŠ›ä»·å€¼è¯„ä¼°ç”±**äººå·¥æŠŠæ¡çµæ´»æ€§**ï¼Œç³»ç»Ÿæä¾›è®¡ç®—åŠŸèƒ½ã€‚ç®—æ³•å®ç°"ç¨³å®šæˆæœ+æ”¶ç›Šç™¾åˆ†æ¯”"çš„èƒ½åŠ›ä»·å€¼é‡åŒ–ï¼Œæ”¯æŒè¿ç»­6ä¸ªæœˆç¨³å®šæ€§åˆ¤å®šã€‚

## ğŸ¯ ç”¨æˆ·è¯´æ˜æŒ‡å¼•

### ä»€ä¹ˆæ˜¯èƒ½åŠ›ä»·å€¼è®¡ç®—ï¼Ÿ
èƒ½åŠ›ä»·å€¼è®¡ç®—æ˜¯è¯„ä¼°ä¼ä¸šæ ¸å¿ƒèƒ½åŠ›ä»·å€¼çš„æ–¹æ³•ã€‚å®ƒé€šè¿‡åˆ†æèƒ½åŠ›å¸¦æ¥çš„ç¨³å®šæˆæœå’Œæ”¶ç›Šè´¡çŒ®ï¼Œé‡åŒ–èƒ½åŠ›çš„çœŸå®ä»·å€¼ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦èƒ½åŠ›ä»·å€¼è®¡ç®—ï¼Ÿ
- **èƒ½åŠ›ä»·å€¼é‡åŒ–**ï¼šå°†æŠ½è±¡çš„ä¼ä¸šèƒ½åŠ›è½¬åŒ–ä¸ºå…·ä½“çš„è´§å¸ä»·å€¼
- **èƒ½åŠ›æŠ•èµ„å†³ç­–**ï¼šå¸®åŠ©åˆ¤æ–­èƒ½åŠ›å»ºè®¾æŠ•èµ„æ˜¯å¦å€¼å¾—
- **èƒ½åŠ›ä¼˜åŒ–æŒ‡å¯¼**ï¼šä¸ºèƒ½åŠ›æå‡æä¾›æ•°æ®æ”¯æŒ

### è®¡ç®—æ­¥éª¤è¯´æ˜
1. **ç¡®å®šç¨³å®šæˆæœ**ï¼šè¯†åˆ«èƒ½åŠ›å¸¦æ¥çš„å¯é‡åŒ–æˆæœï¼ˆå¦‚è´¨é‡åˆæ ¼ç‡ã€ä¸Šå¸‚å‘¨æœŸç­‰ï¼‰
2. **è®¡ç®—è´¡çŒ®ç™¾åˆ†æ¯”**ï¼š(å½“å‰æˆæœ - åŸºå‡†æˆæœ) Ã· å½“å‰æˆæœ Ã— 100%
3. **ç¡®å®šå¹´åº¦æ”¶ç›Š**ï¼šè®¡ç®—èƒ½åŠ›å¸¦æ¥çš„å¹´åº¦æ”¶ç›Šï¼ˆå¦‚æˆæœ¬èŠ‚çœã€æ”¶å…¥å¢é‡ç­‰ï¼‰
4. **è®¡ç®—æœˆåº¦ä»·å€¼**ï¼šå¹´åº¦æ”¶ç›Š Ã— è´¡çŒ®ç™¾åˆ†æ¯” Ã· 12
5. **ç¨³å®šæ€§æ£€æŸ¥**ï¼šéªŒè¯æ˜¯å¦è¿ç»­6ä¸ªæœˆè¾¾åˆ°æ ‡å‡†

### æ•°æ®æ¥æºè¯´æ˜
- **ç¨³å®šæˆæœ**ï¼šæ¥è‡ªMESè´¨æ£€æ¨¡å—ã€ç ”å‘ç®¡ç†ç³»ç»Ÿã€è¥é”€ç³»ç»Ÿç­‰
- **åŸºå‡†æˆæœ**ï¼šå†å²æ— è¯¥èƒ½åŠ›æ—¶çš„å¹³å‡æˆæœæ°´å¹³
- **å¹´åº¦æ”¶ç›Š**ï¼šæ¥è‡ªè´¢åŠ¡éƒ¨æˆæœ¬æŠ¥è¡¨ã€CRMæ”¶å…¥æ•°æ®ç­‰
- **è´¡çŒ®ç™¾åˆ†æ¯”**ï¼šåŸºäºæˆæœæå‡å¹…åº¦è®¡ç®—

### ä½¿ç”¨åœºæ™¯
- **èƒ½åŠ›æŠ•èµ„è¯„ä¼°**ï¼šè¯„ä¼°èƒ½åŠ›å»ºè®¾æŠ•èµ„ä»·å€¼
- **èƒ½åŠ›ä»·å€¼ç›‘æ§**ï¼šå®šæœŸè¯„ä¼°èƒ½åŠ›ä»·å€¼å˜åŒ–
- **èƒ½åŠ›ä¼˜åŒ–æŒ‡å¯¼**ï¼šè¯†åˆ«éœ€è¦ä¼˜åŒ–çš„èƒ½åŠ›ç±»å‹

## ğŸ¯ æ ¸å¿ƒå…¬å¼

### 1. èƒ½åŠ›ä»·å€¼è®¡ç®—
```
â–³èƒ½åŠ›ä»·å€¼ = ç¨³å®šæˆæœå¯¹åº”çš„å¹´åº¦æ”¶ç›Š Ã— è´¡çŒ®ç™¾åˆ†æ¯” Ã· 12
```

### 2. è´¡çŒ®ç™¾åˆ†æ¯”è®¡ç®—
```
è´¡çŒ®ç™¾åˆ†æ¯” = (å½“å‰æˆæœ - åŸºå‡†æˆæœ) Ã· å½“å‰æˆæœ Ã— 100%
```

### 3. ç¨³å®šæ€§åˆ¤å®š
```
ç¨³å®šæ€§ = è¿ç»­6ä¸ªæœˆè¾¾åˆ°æ ‡å‡†æˆæœ
```

## ğŸ”§ ç®—æ³•å®ç°

### 1. TypeScriptå®ç°

```typescript
// èƒ½åŠ›ä»·å€¼è®¡ç®—æ¥å£
interface CapabilityValueCalculation {
  capabilityId: string;
  capabilityType: 'production' | 'rd' | 'marketing' | 'delivery' | 'channel';
  stableOutcome: StableOutcome;
  annualRevenue: number;
  contributionPercentage: number;
  monthlyValue: number;
  stabilityStatus: 'stable' | 'unstable' | 'pending';
  calculationDate: Date;
}

// ç¨³å®šæˆæœå®šä¹‰
interface StableOutcome {
  metric: string;
  currentValue: number;
  baselineValue: number;
  targetValue: number;
  unit: string;
  measurementPeriod: number; // è¿ç»­æœˆæ•°
}

// èƒ½åŠ›ä»·å€¼è®¡ç®—å™¨
class CapabilityValueCalculator {
  private readonly STABILITY_MONTHS = 6;
  private readonly CONTRIBUTION_THRESHOLD = 0.05; // 5%æœ€å°è´¡çŒ®

  /**
   * è®¡ç®—èƒ½åŠ›ä»·å€¼
   * @param capabilityId èƒ½åŠ›ID
   * @param stableOutcome ç¨³å®šæˆæœ
   * @param annualRevenue å¹´åº¦æ”¶ç›Š
   * @returns èƒ½åŠ›ä»·å€¼è®¡ç®—ç»“æœ
   */
  async calculateCapabilityValue(
    capabilityId: string,
    stableOutcome: StableOutcome,
    annualRevenue: number
  ): Promise<CapabilityValueCalculation> {
    // 1. éªŒè¯è¾“å…¥æ•°æ®
    this.validateInputs(stableOutcome, annualRevenue);
    
    // 2. è®¡ç®—è´¡çŒ®ç™¾åˆ†æ¯”
    const contributionPercentage = this.calculateContributionPercentage(stableOutcome);
    
    // 3. è®¡ç®—æœˆåº¦ä»·å€¼
    const monthlyValue = this.calculateMonthlyValue(annualRevenue, contributionPercentage);
    
    // 4. æ£€æŸ¥ç¨³å®šæ€§çŠ¶æ€
    const stabilityStatus = await this.checkStabilityStatus(capabilityId, stableOutcome);
    
    return {
      capabilityId,
      capabilityType: this.getCapabilityType(capabilityId),
      stableOutcome,
      annualRevenue,
      contributionPercentage,
      monthlyValue,
      stabilityStatus,
      calculationDate: new Date()
    };
  }

  /**
   * è®¡ç®—è´¡çŒ®ç™¾åˆ†æ¯”
   */
  private calculateContributionPercentage(stableOutcome: StableOutcome): number {
    const { currentValue, baselineValue } = stableOutcome;
    
    if (currentValue <= baselineValue) {
      return 0; // æ— è´¡çŒ®
    }
    
    const contribution = (currentValue - baselineValue) / currentValue;
    return Math.max(contribution, this.CONTRIBUTION_THRESHOLD);
  }

  /**
   * è®¡ç®—æœˆåº¦ä»·å€¼
   */
  private calculateMonthlyValue(annualRevenue: number, contributionPercentage: number): number {
    return (annualRevenue * contributionPercentage) / 12;
  }

  /**
   * æ£€æŸ¥ç¨³å®šæ€§çŠ¶æ€
   */
  private async checkStabilityStatus(
    capabilityId: string,
    stableOutcome: StableOutcome
  ): Promise<'stable' | 'unstable' | 'pending'> {
    // æŸ¥è¯¢æœ€è¿‘6ä¸ªæœˆçš„æ•°æ®
    const recentData = await this.getRecentCapabilityData(capabilityId, this.STABILITY_MONTHS);
    
    if (recentData.length < this.STABILITY_MONTHS) {
      return 'pending'; // æ•°æ®ä¸è¶³
    }
    
    // æ£€æŸ¥æ˜¯å¦è¿ç»­6ä¸ªæœˆè¾¾åˆ°æ ‡å‡†
    const isStable = recentData.every(data => 
      data.metricValue >= stableOutcome.targetValue
    );
    
    return isStable ? 'stable' : 'unstable';
  }

  /**
   * è·å–èƒ½åŠ›ç±»å‹
   */
  private getCapabilityType(capabilityId: string): string {
    // æ ¹æ®èƒ½åŠ›IDæˆ–åç§°åˆ¤æ–­ç±»å‹
    const capabilityTypes = {
      'production': ['ç”Ÿäº§', 'åˆ¶é€ ', 'åŠ å·¥'],
      'rd': ['ç ”å‘', 'åˆ›æ–°', 'æŠ€æœ¯'],
      'marketing': ['è¥é”€', 'æ¨å¹¿', 'ä¼ æ’­'],
      'delivery': ['äº¤ä»˜', 'ç‰©æµ', 'é…é€'],
      'channel': ['æ¸ é“', 'é”€å”®', 'åˆ†é”€']
    };
    
    for (const [type, keywords] of Object.entries(capabilityTypes)) {
      if (keywords.some(keyword => capabilityId.includes(keyword))) {
        return type;
      }
    }
    
    return 'unknown';
  }

  /**
   * éªŒè¯è¾“å…¥æ•°æ®
   */
  private validateInputs(stableOutcome: StableOutcome, annualRevenue: number): void {
    if (stableOutcome.currentValue <= 0) {
      throw new Error('å½“å‰æˆæœå€¼å¿…é¡»å¤§äº0');
    }
    
    if (stableOutcome.baselineValue < 0) {
      throw new Error('åŸºå‡†æˆæœå€¼ä¸èƒ½ä¸ºè´Ÿæ•°');
    }
    
    if (stableOutcome.targetValue <= stableOutcome.baselineValue) {
      throw new Error('ç›®æ ‡æˆæœå€¼å¿…é¡»å¤§äºåŸºå‡†æˆæœå€¼');
    }
    
    if (annualRevenue <= 0) {
      throw new Error('å¹´åº¦æ”¶ç›Šå¿…é¡»å¤§äº0');
    }
  }
}
```

### 2. æ•°æ®åº“å­˜å‚¨

```sql
-- èƒ½åŠ›ä»·å€¼è®¡ç®—å‡½æ•°
CREATE OR REPLACE FUNCTION calculate_capability_value(
  p_capability_id UUID,
  p_current_value DECIMAL(10,4),
  p_baseline_value DECIMAL(10,4),
  p_target_value DECIMAL(10,4),
  p_annual_revenue DECIMAL(15,2)
) RETURNS TABLE(
  contribution_percentage DECIMAL(5,4),
  monthly_value DECIMAL(15,2),
  stability_status TEXT
) AS $$
DECLARE
  v_contribution_percentage DECIMAL(5,4);
  v_monthly_value DECIMAL(15,2);
  v_stability_status TEXT;
  v_recent_data_count INTEGER;
BEGIN
  -- è®¡ç®—è´¡çŒ®ç™¾åˆ†æ¯”
  IF p_current_value <= p_baseline_value THEN
    v_contribution_percentage := 0;
  ELSE
    v_contribution_percentage := (p_current_value - p_baseline_value) / p_current_value;
    -- æœ€å°è´¡çŒ®5%
    IF v_contribution_percentage < 0.05 THEN
      v_contribution_percentage := 0.05;
    END IF;
  END IF;
  
  -- è®¡ç®—æœˆåº¦ä»·å€¼
  v_monthly_value := (p_annual_revenue * v_contribution_percentage) / 12;
  
  -- æ£€æŸ¥ç¨³å®šæ€§çŠ¶æ€
  SELECT COUNT(*) INTO v_recent_data_count
  FROM capability_value_assessment
  WHERE capability_id = p_capability_id
    AND month_date >= CURRENT_DATE - INTERVAL '6 months'
    AND metric_value >= p_target_value;
  
  IF v_recent_data_count < 6 THEN
    v_stability_status := 'pending';
  ELSIF v_recent_data_count = 6 THEN
    v_stability_status := 'stable';
  ELSE
    v_stability_status := 'unstable';
  END IF;
  
  RETURN QUERY SELECT v_contribution_percentage, v_monthly_value, v_stability_status;
END;
$$ LANGUAGE plpgsql;
```

## ğŸ“Š å…·ä½“èƒ½åŠ›ç±»å‹è®¡ç®—

### 1. ç”Ÿäº§èƒ½åŠ›è®¡ç®—

```typescript
// ç”Ÿäº§èƒ½åŠ›ä»·å€¼è®¡ç®—
class ProductionCapabilityCalculator extends CapabilityValueCalculator {
  /**
   * è®¡ç®—ç”Ÿäº§èƒ½åŠ›ä»·å€¼
   */
  async calculateProductionValue(
    capabilityId: string,
    qualityRate: number, // è´¨é‡åˆæ ¼ç‡
    baselineQualityRate: number, // åŸºå‡†åˆæ ¼ç‡
    annualRevenue: number
  ): Promise<CapabilityValueCalculation> {
    const stableOutcome: StableOutcome = {
      metric: 'è´¨é‡åˆæ ¼ç‡',
      currentValue: qualityRate,
      baselineValue: baselineQualityRate,
      targetValue: 0.96, // 96%ç›®æ ‡
      unit: '%',
      measurementPeriod: 6
    };
    
    return await this.calculateCapabilityValue(capabilityId, stableOutcome, annualRevenue);
  }
  
  /**
   * è®¡ç®—è¿”å·¥æˆæœ¬èŠ‚çœ
   */
  private calculateReworkCostSaving(qualityRate: number, baselineRate: number, totalCost: number): number {
    const improvement = qualityRate - baselineRate;
    return totalCost * improvement; // è¿”å·¥æˆæœ¬èŠ‚çœ
  }
  
  /**
   * è®¡ç®—å¤è´­å¢é‡
   */
  private calculateRepurchaseIncrement(qualityRate: number, baselineRate: number, customerBase: number, avgOrderValue: number): number {
    const improvement = qualityRate - baselineRate;
    const repurchaseRate = improvement * 0.1; // å‡è®¾è´¨é‡æå‡10%å¸¦æ¥1%å¤è´­ç‡æå‡
    return customerBase * repurchaseRate * avgOrderValue;
  }
}
```

### 2. ç ”å‘èƒ½åŠ›è®¡ç®—

```typescript
// ç ”å‘èƒ½åŠ›ä»·å€¼è®¡ç®—
class RDCapabilityCalculator extends CapabilityValueCalculator {
  /**
   * è®¡ç®—ç ”å‘èƒ½åŠ›ä»·å€¼
   */
  async calculateRDValue(
    capabilityId: string,
    timeToMarket: number, // ä¸Šå¸‚å‘¨æœŸï¼ˆæœˆï¼‰
    baselineTimeToMarket: number, // åŸºå‡†ä¸Šå¸‚å‘¨æœŸ
    annualRevenue: number
  ): Promise<CapabilityValueCalculation> {
    const stableOutcome: StableOutcome = {
      metric: 'ä¸Šå¸‚å‘¨æœŸ',
      currentValue: timeToMarket,
      baselineValue: baselineTimeToMarket,
      targetValue: 12, // 12ä¸ªæœˆç›®æ ‡
      unit: 'æœˆ',
      measurementPeriod: 6
    };
    
    return await this.calculateCapabilityValue(capabilityId, stableOutcome, annualRevenue);
  }
  
  /**
   * è®¡ç®—æå‰ä¸Šå¸‚æ”¶ç›Š
   */
  private calculateEarlyMarketRevenue(
    timeToMarket: number,
    baselineTimeToMarket: number,
    monthlyRevenue: number
  ): number {
    const monthsSaved = baselineTimeToMarket - timeToMarket;
    return monthsSaved * monthlyRevenue;
  }
  
  /**
   * è®¡ç®—ä¸“åˆ©æˆæƒè´¹
   */
  private calculatePatentLicenseFee(patentCount: number, avgLicenseFee: number): number {
    return patentCount * avgLicenseFee;
  }
}
```

### 3. æ’­ä¼ èƒ½åŠ›è®¡ç®—

```typescript
// æ’­ä¼ èƒ½åŠ›ä»·å€¼è®¡ç®—
class MarketingCapabilityCalculator extends CapabilityValueCalculator {
  /**
   * è®¡ç®—æ’­ä¼ èƒ½åŠ›ä»·å€¼
   */
  async calculateMarketingValue(
    capabilityId: string,
    conversionRate: number, // è½¬åŒ–ç‡
    baselineConversionRate: number, // åŸºå‡†è½¬åŒ–ç‡
    annualRevenue: number
  ): Promise<CapabilityValueCalculation> {
    const stableOutcome: StableOutcome = {
      metric: 'è½¬åŒ–ç‡',
      currentValue: conversionRate,
      baselineValue: baselineConversionRate,
      targetValue: 0.28, // 28%ç›®æ ‡
      unit: '%',
      measurementPeriod: 6
    };
    
    return await this.calculateCapabilityValue(capabilityId, stableOutcome, annualRevenue);
  }
  
  /**
   * è®¡ç®—è·å®¢æˆæœ¬èŠ‚çœ
   */
  private calculateCustomerAcquisitionCostSaving(
    conversionRate: number,
    baselineRate: number,
    marketingBudget: number
  ): number {
    const improvement = conversionRate - baselineRate;
    return marketingBudget * improvement; // è½¬åŒ–ç‡æå‡å¸¦æ¥çš„æˆæœ¬èŠ‚çœ
  }
  
  /**
   * è®¡ç®—è½¬åŒ–å¢é‡
   */
  private calculateConversionIncrement(
    conversionRate: number,
    baselineRate: number,
    traffic: number,
    avgOrderValue: number
  ): number {
    const improvement = conversionRate - baselineRate;
    return traffic * improvement * avgOrderValue;
  }
}
```

## ğŸ”„ ç¨³å®šæ€§åˆ¤å®šç®—æ³•

### 1. è¿ç»­ç¨³å®šæ€§æ£€æŸ¥

```typescript
// ç¨³å®šæ€§åˆ¤å®šå™¨
class StabilityChecker {
  private readonly STABILITY_MONTHS = 6;
  private readonly STABILITY_THRESHOLD = 0.95; // 95%ç¨³å®šæ€§é˜ˆå€¼

  /**
   * æ£€æŸ¥èƒ½åŠ›ç¨³å®šæ€§
   */
  async checkCapabilityStability(
    capabilityId: string,
    metricType: string,
    targetValue: number
  ): Promise<StabilityResult> {
    // 1. è·å–æœ€è¿‘6ä¸ªæœˆæ•°æ®
    const recentData = await this.getRecentCapabilityData(capabilityId, this.STABILITY_MONTHS);
    
    // 2. è®¡ç®—ç¨³å®šæ€§æŒ‡æ ‡
    const stabilityMetrics = this.calculateStabilityMetrics(recentData, targetValue);
    
    // 3. åˆ¤å®šç¨³å®šæ€§çŠ¶æ€
    const stabilityStatus = this.determineStabilityStatus(stabilityMetrics);
    
    return {
      capabilityId,
      metricType,
      targetValue,
      stabilityStatus,
      stabilityMetrics,
      recommendation: this.generateRecommendation(stabilityStatus, stabilityMetrics)
    };
  }

  /**
   * è®¡ç®—ç¨³å®šæ€§æŒ‡æ ‡
   */
  private calculateStabilityMetrics(data: CapabilityData[], targetValue: number): StabilityMetrics {
    const totalMonths = data.length;
    constè¾¾æ ‡Months = data.filter(d => d.metricValue >= targetValue).length;
    constè¾¾æ ‡ç‡ = è¾¾æ ‡Months / totalMonths;
    
    const values = data.map(d => d.metricValue);
    constå¹³å‡å€¼ = values.reduce((sum, val) => sum + val, 0) / values.length;
    constæ ‡å‡†å·® = this.calculateStandardDeviation(values);
    constå˜å¼‚ç³»æ•° = æ ‡å‡†å·® / å¹³å‡å€¼;
    
    return {
      totalMonths,
      è¾¾æ ‡Months,
      è¾¾æ ‡ç‡,
      å¹³å‡å€¼,
      æ ‡å‡†å·®,
      å˜å¼‚ç³»æ•°,
      isStable: è¾¾æ ‡ç‡ >= this.STABILITY_THRESHOLD
    };
  }

  /**
   * åˆ¤å®šç¨³å®šæ€§çŠ¶æ€
   */
  private determineStabilityStatus(metrics: StabilityMetrics): 'stable' | 'unstable' | 'pending' {
    if (metrics.totalMonths < this.STABILITY_MONTHS) {
      return 'pending';
    }
    
    if (metrics.isStable && metrics.å˜å¼‚ç³»æ•° < 0.1) {
      return 'stable';
    }
    
    return 'unstable';
  }
}
```

### 2. æ•°æ®åº“ç¨³å®šæ€§æ£€æŸ¥

```sql
-- èƒ½åŠ›ç¨³å®šæ€§æ£€æŸ¥å‡½æ•°
CREATE OR REPLACE FUNCTION check_capability_stability(
  p_capability_id UUID,
  p_metric_type TEXT,
  p_target_value DECIMAL(10,4)
) RETURNS TABLE(
  stability_status TEXT,
 è¾¾æ ‡ç‡ DECIMAL(5,4),
 å¹³å‡å€¼ DECIMAL(10,4),
 æ ‡å‡†å·® DECIMAL(10,4),
 å˜å¼‚ç³»æ•° DECIMAL(10,4)
) AS $$
DECLARE
  v_total_months INTEGER;
  v_è¾¾æ ‡_months INTEGER;
  v_è¾¾æ ‡ç‡ DECIMAL(5,4);
  v_å¹³å‡å€¼ DECIMAL(10,4);
  v_æ ‡å‡†å·® DECIMAL(10,4);
  v_å˜å¼‚ç³»æ•° DECIMAL(10,4);
  v_stability_status TEXT;
BEGIN
  -- è·å–æœ€è¿‘6ä¸ªæœˆæ•°æ®
  SELECT COUNT(*), COUNT(CASE WHEN metric_value >= p_target_value THEN 1 END)
  INTO v_total_months, v_è¾¾æ ‡_months
  FROM capability_value_assessment
  WHERE capability_id = p_capability_id
    AND month_date >= CURRENT_DATE - INTERVAL '6 months';
  
  -- è®¡ç®—è¾¾æ ‡ç‡
  IF v_total_months > 0 THEN
    v_è¾¾æ ‡ç‡ := v_è¾¾æ ‡_months::DECIMAL / v_total_months;
  ELSE
    v_è¾¾æ ‡ç‡ := 0;
  END IF;
  
  -- è®¡ç®—å¹³å‡å€¼
  SELECT AVG(metric_value) INTO v_å¹³å‡å€¼
  FROM capability_value_assessment
  WHERE capability_id = p_capability_id
    AND month_date >= CURRENT_DATE - INTERVAL '6 months';
  
  -- è®¡ç®—æ ‡å‡†å·®
  SELECT STDDEV(metric_value) INTO v_æ ‡å‡†å·®
  FROM capability_value_assessment
  WHERE capability_id = p_capability_id
    AND month_date >= CURRENT_DATE - INTERVAL '6 months';
  
  -- è®¡ç®—å˜å¼‚ç³»æ•°
  IF v_å¹³å‡å€¼ > 0 THEN
    v_å˜å¼‚ç³»æ•° := v_æ ‡å‡†å·® / v_å¹³å‡å€¼;
  ELSE
    v_å˜å¼‚ç³»æ•° := 0;
  END IF;
  
  -- åˆ¤å®šç¨³å®šæ€§çŠ¶æ€
  IF v_total_months < 6 THEN
    v_stability_status := 'pending';
  ELSIF v_è¾¾æ ‡ç‡ >= 0.95 AND v_å˜å¼‚ç³»æ•° < 0.1 THEN
    v_stability_status := 'stable';
  ELSE
    v_stability_status := 'unstable';
  END IF;
  
  RETURN QUERY SELECT v_stability_status, v_è¾¾æ ‡ç‡, v_å¹³å‡å€¼, v_æ ‡å‡†å·®, v_å˜å¼‚ç³»æ•°;
END;
$$ LANGUAGE plpgsql;
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ‰¹é‡è®¡ç®—

```typescript
// æ‰¹é‡èƒ½åŠ›ä»·å€¼è®¡ç®—
class BatchCapabilityCalculator {
  private batchSize = 5;
  private batchTimeout = 500; // 0.5ç§’

  /**
   * æ‰¹é‡è®¡ç®—å¤šä¸ªèƒ½åŠ›ä»·å€¼
   */
  async batchCalculateCapabilityValues(
    capabilities: CapabilityValueInput[]
  ): Promise<CapabilityValueCalculation[]> {
    const results: CapabilityValueCalculation[] = [];
    
    for (let i = 0; i < capabilities.length; i += this.batchSize) {
      const batch = capabilities.slice(i, i + this.batchSize);
      const batchResults = await Promise.all(
        batch.map(capability => this.calculateSingleCapabilityValue(capability))
      );
      results.push(...batchResults);
      
      // é¿å…é˜»å¡ï¼Œè®©å‡ºæ§åˆ¶æƒ
      if (i + this.batchSize < capabilities.length) {
        await this.delay(this.batchTimeout);
      }
    }
    
    return results;
  }
}
```

### 2. ç¼“å­˜ç­–ç•¥

```typescript
// èƒ½åŠ›ä»·å€¼è®¡ç®—ç¼“å­˜
class CapabilityValueCache {
  private cache = new Map<string, any>();
  private ttl = 1800000; // 30åˆ†é’Ÿ

  /**
   * è·å–ç¼“å­˜çš„èƒ½åŠ›ä»·å€¼è®¡ç®—ç»“æœ
   */
  get(capabilityId: string, inputs: any): CapabilityValueCalculation | null {
    const key = this.generateCacheKey(capabilityId, inputs);
    const item = this.cache.get(key);
    
    if (!item || Date.now() > item.expires) {
      this.cache.delete(key);
      return null;
    }
    
    return item.value;
  }

  /**
   * ç¼“å­˜èƒ½åŠ›ä»·å€¼è®¡ç®—ç»“æœ
   */
  set(capabilityId: string, inputs: any, result: CapabilityValueCalculation): void {
    const key = this.generateCacheKey(capabilityId, inputs);
    this.cache.set(key, {
      value: result,
      expires: Date.now() + this.ttl
    });
  }
}
```

## ğŸš€ å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šåŸºç¡€ç®—æ³•å®ç°ï¼ˆWeek 1ï¼‰
1. **TypeScriptè®¡ç®—å™¨**ï¼šå®ç°CapabilityValueCalculatorç±»
2. **æ•°æ®åº“å‡½æ•°**ï¼šå®ç°calculate_capability_valueå‡½æ•°
3. **ç¨³å®šæ€§æ£€æŸ¥**ï¼šå®ç°ç¨³å®šæ€§åˆ¤å®šç®—æ³•

### é˜¶æ®µ2ï¼šå…·ä½“èƒ½åŠ›ç±»å‹ï¼ˆWeek 2ï¼‰
1. **ç”Ÿäº§èƒ½åŠ›**ï¼šå®ç°ç”Ÿäº§è´¨é‡åˆæ ¼ç‡è®¡ç®—
2. **ç ”å‘èƒ½åŠ›**ï¼šå®ç°ä¸Šå¸‚å‘¨æœŸè®¡ç®—
3. **æ’­ä¼ èƒ½åŠ›**ï¼šå®ç°è½¬åŒ–ç‡è®¡ç®—

### é˜¶æ®µ3ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆWeek 3ï¼‰
1. **æ‰¹é‡è®¡ç®—**ï¼šå®ç°æ‰¹é‡èƒ½åŠ›ä»·å€¼è®¡ç®—
2. **ç¼“å­˜ç­–ç•¥**ï¼šå®ç°è®¡ç®—ç»“æœç¼“å­˜
3. **æ€§èƒ½æµ‹è¯•**ï¼šéªŒè¯æ€§èƒ½æŒ‡æ ‡

---

**æœ¬ç®—æ³•è®¾è®¡ç¡®ä¿èƒ½åŠ›ä»·å€¼è®¡ç®—çš„å‡†ç¡®æ€§å’Œçµæ´»æ€§ï¼Œæ”¯æŒå¤šç§èƒ½åŠ›ç±»å‹å’Œç¨³å®šæ€§åˆ¤å®šï¼Œæ»¡è¶³100å®¶ä¼ä¸šçš„è®¡ç®—éœ€æ±‚ã€‚**
