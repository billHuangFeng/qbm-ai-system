# Excel数据导入模板规范

## 概述

本文档定义了7个Excel模板文件的结构和格式，用于数据导入到边际分析系统。每个模板都有明确的数据结构、验证规则和导入说明。

## 模板列表

1. **资产清单模板** - `asset_master_template.xlsx`
2. **能力清单模板** - `capability_master_template.xlsx`
3. **产品价值评估项模板** - `product_value_items_template.xlsx`
4. **月度增量指标模板** - `monthly_delta_metrics_template.xlsx`
5. **动态反馈配置模板** - `dynamic_feedback_config_template.xlsx`
6. **模型参数模板** - `model_parameters_template.xlsx`
7. **业务事实数据模板** - `business_facts_template.xlsx`

## 1. 资产清单模板 (asset_master_template.xlsx)

### 文件结构
```
工作表1: 资产清单
工作表2: 数据验证规则
工作表3: 导入说明
```

### 数据列定义
| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|----------|------|------|------|
| 资产编码 | 文本 | 是 | 唯一标识符 | ASSET-001 |
| 资产名称 | 文本 | 是 | 资产名称 | 生产设备A |
| 资产类型 | 文本 | 是 | tangible/intangible/financial | tangible |
| 购置日期 | 日期 | 是 | YYYY-MM-DD格式 | 2024-01-01 |
| 购置成本 | 数字 | 是 | 正数，最多2位小数 | 1000000.00 |
| 使用年限 | 整数 | 是 | 正数 | 10 |
| 残值 | 数字 | 否 | 非负数，最多2位小数 | 100000.00 |
| 折旧方法 | 文本 | 否 | straight_line/declining_balance | straight_line |
| 折现率 | 数字 | 否 | 0-1之间，最多4位小数 | 0.1000 |
| 现金流年数 | 整数 | 否 | 1-10之间 | 5 |
| 年度现金流1 | 数字 | 否 | 最多2位小数 | 120000.00 |
| 年度现金流2 | 数字 | 否 | 最多2位小数 | 130000.00 |
| 年度现金流3 | 数字 | 否 | 最多2位小数 | 140000.00 |
| 年度现金流4 | 数字 | 否 | 最多2位小数 | 150000.00 |
| 年度现金流5 | 数字 | 否 | 最多2位小数 | 160000.00 |

### 数据验证规则
```excel
资产类型: 下拉列表 [tangible, intangible, financial]
折旧方法: 下拉列表 [straight_line, declining_balance, sum_of_years]
折现率: 0 <= 值 <= 1
现金流年数: 1 <= 值 <= 10
购置成本: 值 > 0
使用年限: 值 > 0
```

### 示例数据
```
资产编码,资产名称,资产类型,购置日期,购置成本,使用年限,残值,折旧方法,折现率,现金流年数,年度现金流1,年度现金流2,年度现金流3,年度现金流4,年度现金流5
ASSET-001,生产设备A,tangible,2024-01-01,1000000.00,10,100000.00,straight_line,0.1000,5,120000.00,130000.00,140000.00,150000.00,160000.00
ASSET-002,办公设备,intangible,2024-01-15,500000.00,5,50000.00,straight_line,0.1000,5,100000.00,110000.00,120000.00,130000.00,140000.00
```

## 2. 能力清单模板 (capability_master_template.xlsx)

### 数据列定义
| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|----------|------|------|------|
| 能力编码 | 文本 | 是 | 唯一标识符 | CAP-001 |
| 能力名称 | 文本 | 是 | 能力名称 | 数据分析能力 |
| 能力类型 | 文本 | 是 | technical/business/management/operational | technical |
| 能力级别 | 文本 | 是 | beginner/intermediate/advanced/expert | advanced |
| 描述 | 文本 | 否 | 能力描述 | 高级数据分析能力 |
| 贡献百分比 | 数字 | 否 | 0-1之间，最多4位小数 | 0.2500 |
| 年度收益 | 数字 | 否 | 非负数，最多2位小数 | 500000.00 |
| 收益测量周期 | 整数 | 否 | 1-24之间 | 12 |
| 最后测量日期 | 日期 | 否 | YYYY-MM-DD格式 | 2024-01-20 |
| 下次测量日期 | 日期 | 否 | YYYY-MM-DD格式 | 2024-02-20 |

### 数据验证规则
```excel
能力类型: 下拉列表 [technical, business, management, operational]
能力级别: 下拉列表 [beginner, intermediate, advanced, expert]
贡献百分比: 0 <= 值 <= 1
收益测量周期: 1 <= 值 <= 24
年度收益: 值 >= 0
```

### 示例数据
```
能力编码,能力名称,能力类型,能力级别,描述,贡献百分比,年度收益,收益测量周期,最后测量日期,下次测量日期
CAP-001,数据分析能力,technical,advanced,高级数据分析能力,0.2500,500000.00,12,2024-01-20,2024-02-20
CAP-002,项目管理能力,management,expert,专家级项目管理能力,0.3000,600000.00,12,2024-01-18,2024-02-18
```

## 3. 产品价值评估项模板 (product_value_items_template.xlsx)

### 数据列定义
| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|----------|------|------|------|
| 产品ID | 文本 | 是 | 产品标识符 | PROD-001 |
| 产品名称 | 文本 | 是 | 产品名称 | 产品A |
| 价值类别 | 文本 | 是 | intrinsic/cognitive/experiential | intrinsic |
| 评估项名称 | 文本 | 是 | 评估项名称 | 产品质量 |
| 评估项描述 | 文本 | 否 | 评估项描述 | 基于客户反馈的产品质量评分 |
| 权重 | 数字 | 是 | 0-1之间，最多4位小数 | 0.3000 |
| 最高得分 | 数字 | 否 | 正数，最多2位小数 | 10.00 |
| 当前得分 | 数字 | 否 | 0-最高得分之间 | 8.50 |
| 目标得分 | 数字 | 否 | 0-最高得分之间 | 9.00 |
| 评估方法 | 文本 | 否 | survey/expert_judgment/data_analysis | survey |
| 最后评估日期 | 日期 | 否 | YYYY-MM-DD格式 | 2024-01-20 |
| 下次评估日期 | 日期 | 否 | YYYY-MM-DD格式 | 2024-02-20 |

### 数据验证规则
```excel
价值类别: 下拉列表 [intrinsic, cognitive, experiential]
评估方法: 下拉列表 [survey, expert_judgment, data_analysis]
权重: 0 <= 值 <= 1
当前得分: 0 <= 值 <= 最高得分
目标得分: 0 <= 值 <= 最高得分
最高得分: 值 > 0
```

### 示例数据
```
产品ID,产品名称,价值类别,评估项名称,评估项描述,权重,最高得分,当前得分,目标得分,评估方法,最后评估日期,下次评估日期
PROD-001,产品A,intrinsic,产品质量,基于客户反馈的产品质量评分,0.3000,10.00,8.50,9.00,survey,2024-01-20,2024-02-20
PROD-001,产品A,cognitive,品牌认知度,基于市场调研的品牌认知度评分,0.2500,10.00,7.80,8.50,survey,2024-01-20,2024-02-20
```

## 4. 月度增量指标模板 (monthly_delta_metrics_template.xlsx)

### 数据列定义
| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|----------|------|------|------|
| 指标编码 | 文本 | 是 | 唯一标识符 | METRIC-001 |
| 指标名称 | 文本 | 是 | 指标名称 | 月度收入 |
| 指标类别 | 文本 | 是 | revenue/cost/efficiency/quality/customer | revenue |
| 指标单位 | 文本 | 否 | currency/percentage/count/ratio | currency |
| 计算方法 | 文本 | 否 | 计算方法描述 | 当月收入 - 上月收入 |
| 报告月份 | 日期 | 是 | YYYY-MM-01格式 | 2024-01-01 |
| 当前值 | 数字 | 是 | 最多4位小数 | 1200000.0000 |
| 上月值 | 数字 | 否 | 最多4位小数 | 1100000.0000 |
| 增量值 | 数字 | 否 | 最多4位小数 | 100000.0000 |
| 增量百分比 | 数字 | 否 | 最多4位小数 | 9.0909 |
| 趋势方向 | 文本 | 否 | up/down/stable | up |
| 趋势强度 | 数字 | 否 | -1到1之间，最多4位小数 | 0.7500 |
| 波动性指数 | 数字 | 否 | 0-1之间，最多4位小数 | 0.1500 |
| 下月预测值 | 数字 | 否 | 最多4位小数 | 1300000.0000 |
| 预测置信度 | 数字 | 否 | 0-1之间，最多4位小数 | 0.8500 |

### 数据验证规则
```excel
指标类别: 下拉列表 [revenue, cost, efficiency, quality, customer]
趋势方向: 下拉列表 [up, down, stable]
趋势强度: -1 <= 值 <= 1
波动性指数: 0 <= 值 <= 1
预测置信度: 0 <= 值 <= 1
增量百分比: -100 <= 值 <= 1000
```

### 示例数据
```
指标编码,指标名称,指标类别,指标单位,计算方法,报告月份,当前值,上月值,增量值,增量百分比,趋势方向,趋势强度,波动性指数,下月预测值,预测置信度
METRIC-001,月度收入,revenue,currency,当月收入 - 上月收入,2024-01-01,1200000.0000,1100000.0000,100000.0000,9.0909,up,0.7500,0.1500,1300000.0000,0.8500
METRIC-002,月度成本,cost,currency,当月成本 - 上月成本,2024-01-01,800000.0000,850000.0000,-50000.0000,-5.8824,down,0.6000,0.2000,780000.0000,0.8000
```

## 5. 动态反馈配置模板 (dynamic_feedback_config_template.xlsx)

### 数据列定义
| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|----------|------|------|------|
| 配置名称 | 文本 | 是 | 唯一标识符 | 利润再投资配置 |
| 配置描述 | 文本 | 否 | 配置描述 | 当利润超过阈值时自动触发再投资 |
| 反馈类型 | 文本 | 是 | profit_reinvestment/resource_allocation/capability_enhancement | profit_reinvestment |
| 触发条件JSON | 文本 | 是 | JSON格式的触发条件 | {"profit_threshold": 1000000, "growth_rate": 0.15} |
| 阈值 | 数字 | 否 | 阈值数值 | 1000000.00 |
| 比较操作符 | 文本 | 否 | >/<>=/<=/=/!= | > |
| 评估周期 | 整数 | 否 | 1-12之间 | 1 |
| 反馈动作JSON | 文本 | 是 | JSON格式的反馈动作 | {"action_type": "resource_allocation", "amount": 200000} |
| 动作优先级 | 整数 | 否 | 1-10之间 | 1 |
| 执行延迟天数 | 整数 | 否 | 0-30之间 | 0 |
| 是否激活 | 文本 | 否 | true/false | true |
| 最后触发日期 | 日期 | 否 | YYYY-MM-DD格式 | 2024-01-20 |
| 下次评估日期 | 日期 | 否 | YYYY-MM-DD格式 | 2024-02-20 |
| 触发次数 | 整数 | 否 | 非负数 | 5 |

### 数据验证规则
```excel
反馈类型: 下拉列表 [profit_reinvestment, resource_allocation, capability_enhancement]
比较操作符: 下拉列表 [>, <, >=, <=, =, !=]
是否激活: 下拉列表 [true, false]
评估周期: 1 <= 值 <= 12
动作优先级: 1 <= 值 <= 10
执行延迟天数: 0 <= 值 <= 30
触发次数: 值 >= 0
```

### 示例数据
```
配置名称,配置描述,反馈类型,触发条件JSON,阈值,比较操作符,评估周期,反馈动作JSON,动作优先级,执行延迟天数,是否激活,最后触发日期,下次评估日期,触发次数
利润再投资配置,当利润超过阈值时自动触发再投资,profit_reinvestment,"{""profit_threshold"": 1000000, ""growth_rate"": 0.15}",1000000.00,>,1,"{""action_type"": ""resource_allocation"", ""amount"": 200000}",1,0,true,2024-01-20,2024-02-20,5
```

## 6. 模型参数模板 (model_parameters_template.xlsx)

### 数据列定义
| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|----------|------|------|------|
| 模型类型 | 文本 | 是 | shapley/timeseries/npv/capability_value | shapley |
| 模型版本 | 文本 | 是 | 版本号 | v1.0 |
| 模型名称 | 文本 | 是 | 模型名称 | Shapley简化版模型 |
| 参数JSON | 文本 | 是 | JSON格式的模型参数 | {"learning_rate": 0.01, "epochs": 100} |
| 超参数JSON | 文本 | 否 | JSON格式的超参数 | {"batch_size": 32, "dropout": 0.2} |
| 特征重要性JSON | 文本 | 否 | JSON格式的特征重要性 | {"feature1": 0.6, "feature2": 0.4} |
| 模型元数据JSON | 文本 | 否 | JSON格式的元数据 | {"created_by": "system", "framework": "sklearn"} |
| 准确率 | 数字 | 否 | 0-1之间，最多6位小数 | 0.850000 |
| R平方 | 数字 | 否 | 0-1之间，最多6位小数 | 0.820000 |
| 平均绝对误差 | 数字 | 否 | 非负数，最多6位小数 | 50000.000000 |
| 均方根误差 | 数字 | 否 | 非负数，最多6位小数 | 75000.000000 |
| 平均绝对百分比误差 | 数字 | 否 | 非负数，最多4位小数 | 8.5000 |
| 训练数据量 | 整数 | 否 | 正数 | 1000 |
| 训练时长秒数 | 整数 | 否 | 非负数 | 300 |
| 最后训练日期 | 日期 | 否 | YYYY-MM-DD格式 | 2024-01-20 |
| 下次重训练日期 | 日期 | 否 | YYYY-MM-DD格式 | 2024-02-20 |
| 模型状态 | 文本 | 否 | active/deprecated/training | active |
| 是否生产环境 | 文本 | 否 | true/false | true |

### 数据验证规则
```excel
模型类型: 下拉列表 [shapley, timeseries, npv, capability_value]
模型状态: 下拉列表 [active, deprecated, training]
是否生产环境: 下拉列表 [true, false]
准确率: 0 <= 值 <= 1
R平方: 0 <= 值 <= 1
平均绝对误差: 值 >= 0
均方根误差: 值 >= 0
平均绝对百分比误差: 值 >= 0
训练数据量: 值 > 0
训练时长秒数: 值 >= 0
```

### 示例数据
```
模型类型,模型版本,模型名称,参数JSON,超参数JSON,特征重要性JSON,模型元数据JSON,准确率,R平方,平均绝对误差,均方根误差,平均绝对百分比误差,训练数据量,训练时长秒数,最后训练日期,下次重训练日期,模型状态,是否生产环境
shapley,v1.0,Shapley简化版模型,"{""learning_rate"": 0.01, ""epochs"": 100}","{""batch_size"": 32, ""dropout"": 0.2}","{""feature1"": 0.6, ""feature2"": 0.4}","{""created_by"": ""system"", ""framework"": ""sklearn""}",0.850000,0.820000,50000.000000,75000.000000,8.5000,1000,300,2024-01-20,2024-02-20,active,true
```

## 7. 业务事实数据模板 (business_facts_template.xlsx)

### 数据列定义
| 列名 | 数据类型 | 必填 | 说明 | 示例 |
|------|----------|------|------|------|
| 事实类型 | 文本 | 是 | expense/asset/procurement/sales/rd/promotion | expense |
| 事实编码 | 文本 | 是 | 唯一标识符 | FACT-001 |
| 事实名称 | 文本 | 是 | 事实名称 | 办公费用 |
| 发生日期 | 日期 | 是 | YYYY-MM-DD格式 | 2024-01-15 |
| 金额 | 数字 | 是 | 最多2位小数 | 5000.00 |
| 币种 | 文本 | 否 | 货币代码 | CNY |
| 部门 | 文本 | 否 | 部门名称 | 财务部 |
| 项目 | 文本 | 否 | 项目名称 | 办公用品采购 |
| 供应商 | 文本 | 否 | 供应商名称 | 办公用品供应商A |
| 产品 | 文本 | 否 | 产品名称 | 办公用品 |
| 数量 | 数字 | 否 | 正数，最多2位小数 | 100.00 |
| 单价 | 数字 | 否 | 正数，最多2位小数 | 50.00 |
| 税率 | 数字 | 否 | 0-1之间，最多4位小数 | 0.1300 |
| 税额 | 数字 | 否 | 非负数，最多2位小数 | 650.00 |
| 总金额 | 数字 | 否 | 非负数，最多2位小数 | 5650.00 |
| 备注 | 文本 | 否 | 备注信息 | 月度办公用品采购 |

### 数据验证规则
```excel
事实类型: 下拉列表 [expense, asset, procurement, sales, rd, promotion]
币种: 下拉列表 [CNY, USD, EUR, JPY]
金额: 值 > 0
数量: 值 > 0
单价: 值 > 0
税率: 0 <= 值 <= 1
税额: 值 >= 0
总金额: 值 >= 0
```

### 示例数据
```
事实类型,事实编码,事实名称,发生日期,金额,币种,部门,项目,供应商,产品,数量,单价,税率,税额,总金额,备注
expense,FACT-001,办公费用,2024-01-15,5000.00,CNY,财务部,办公用品采购,办公用品供应商A,办公用品,100.00,50.00,0.1300,650.00,5650.00,月度办公用品采购
asset,FACT-002,设备采购,2024-01-20,100000.00,CNY,IT部,设备升级,设备供应商B,服务器,1.00,100000.00,0.1300,13000.00,113000.00,服务器设备采购
```

## 通用模板规范

### 文件格式要求
- **文件格式**: .xlsx (Excel 2007+)
- **编码**: UTF-8
- **工作表**: 每个模板至少3个工作表
- **数据行**: 从第2行开始（第1行为标题）
- **最大行数**: 10,000行

### 数据验证
- **下拉列表**: 使用Excel数据验证功能
- **数字格式**: 统一数字格式
- **日期格式**: YYYY-MM-DD格式
- **必填字段**: 使用条件格式标识

### 导入说明
每个模板都包含导入说明工作表，包括：
- 字段说明
- 数据格式要求
- 验证规则
- 常见错误
- 导入步骤

### 错误处理
- **数据验证**: 实时验证数据格式
- **错误提示**: 清晰的错误信息
- **数据修复**: 自动修复常见错误
- **导入日志**: 详细的导入日志

## 使用流程

### 1. 下载模板
用户从系统下载对应的Excel模板文件

### 2. 填写数据
按照模板格式填写数据，系统会实时验证数据格式

### 3. 上传文件
通过文件上传功能上传填写好的Excel文件

### 4. 数据验证
系统自动验证数据格式和业务规则

### 5. 数据导入
验证通过后，数据导入到对应数据库表

### 6. 结果反馈
系统返回导入结果，包括成功数量和错误信息

## 技术实现

### 文件解析
```typescript
interface ExcelParser {
  parseFile(file: File): Promise<ExcelData>;
  validateData(data: ExcelData): ValidationResult;
  transformData(data: ExcelData): TransformedData;
}
```

### 数据验证
```typescript
interface DataValidator {
  validateRow(row: any, rules: ValidationRule[]): ValidationResult;
  validateFile(data: ExcelData): ValidationResult;
  fixCommonErrors(data: ExcelData): ExcelData;
}
```

### 导入处理
```typescript
interface DataImporter {
  importData(data: TransformedData): Promise<ImportResult>;
  rollbackImport(importId: string): Promise<void>;
  getImportStatus(importId: string): ImportStatus;
}
```
