# BMOS数据链架构图

## 🏗️ 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                BMOS系统架构                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│  │   前端应用层     │    │   计算分析层     │    │   数据存储层     │              │
│  │                │    │                │    │                │              │
│  │ React + Next.js │◄──►│ 算法引擎 + API  │◄──►│ PostgreSQL +    │              │
│  │ TypeScript      │    │ TypeScript      │    │ Supabase        │              │
│  │ Tailwind CSS    │    │ Shapley算法     │    │ 实时订阅        │              │
│  │ shadcn/ui       │    │ 价值链分析      │    │ 数据仓库        │              │
│  │ Recharts        │    │ 优化建议生成    │    │ 索引优化        │              │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘              │
│           │                       │                       │                    │
│           ▼                       ▼                       ▼                    │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│  │   用户界面层     │    │   业务逻辑层     │    │   数据模型层     │              │
│  │                │    │                │    │                │              │
│  │ 决策管理界面    │    │ 价值链分析引擎  │    │ 维度表 (9张)    │              │
│  │ 可视化面板      │    │ 归因分析引擎    │    │ 事实表 (5张)    │              │
│  │ 监控仪表盘      │    │ 优化建议引擎    │    │ 桥接表 (5张)    │              │
│  │ 报告生成器      │    │ 决策追踪引擎    │    │ 分析视图 (4张)  │              │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘              │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 📊 数据流向图

```
原始数据源 → 数据采集 → 数据清洗 → 数据存储 → 计算分析 → 结果输出 → 决策应用
     │           │         │         │         │         │         │
     ▼           ▼         ▼         ▼         ▼         ▼         ▼
┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│订单系统 │ │数据连接器│ │数据验证 │ │PostgreSQL│ │算法引擎 │ │可视化   │ │决策执行 │
│客户系统 │ │数据同步 │ │数据补全 │ │Supabase │ │归因分析 │ │报告生成 │ │效果追踪 │
│财务系统 │ │实时订阅 │ │数据映射 │ │数据仓库 │ │优化建议 │ │监控面板 │ │反馈循环 │
│营销系统 │ │API接口  │ │格式转换 │ │索引优化 │ │决策管理 │ │实时更新 │ │持续优化 │
│生产系统 │ │批量导入 │ │质量检查 │ │缓存策略 │ │效果评估 │ │用户界面 │ │迭代改进 │
└─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘
```

## 🗄️ 数据模型关系图

```
                    ┌─────────────────────────────────────────┐
                    │              维度表 (9张)                │
                    ├─────────────────────────────────────────┤
                    │                                         │
┌─────────────┐    │  dim_vpt        dim_pft        dim_sku  │
│  事实表     │    │  (价值主张)     (产品特性)     (产品)    │
│   (5张)     │    │                                         │
│             │    │  dim_customer   dim_supplier   dim_date │
│ fact_order  │◄──►│  (客户)         (供应商)       (日期)    │
│ fact_voice  │    │                                         │
│ fact_cost   │    │  dim_activity   dim_media_     dim_conv │
│ fact_supplier│   │  (活动)         channel        channel  │
│ fact_produce│    │                 (媒体渠道)     (转化渠道)│
└─────────────┘    └─────────────────────────────────────────┘
         │                           │
         ▼                           ▼
┌─────────────────────────────────────────────────────────────┐
│                    桥接表 (5张)                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  bridge_media_vpt    bridge_conv_vpt    bridge_sku_pft     │
│  (媒体-价值主张)     (转化-价值主张)     (产品-特性)        │
│                                                             │
│  bridge_vpt_pft      bridge_attribution                    │
│  (价值主张-特性)     (归因分析)                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 🔄 价值链分析流程图

```
核心资源+能力 → 产品特性 → 价值主张 → 客户感知 → 体验价值 → 客户买单
      │            │          │          │          │          │
      ▼            ▼          ▼          ▼          ▼          ▼
┌─────────┐  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│供应商   │  │功能参数 │ │价值匹配 │ │品牌认知 │ │体验满意 │ │转化率   │
│到货率   │  │达标率   │ │度       │ │度       │ │度       │ │         │
│         │  │         │ │         │ │         │ │         │ │         │
│资源利用 │  │质量合格 │ │差异化   │ │价值感知 │ │推荐意愿 │ │客单价   │
│率       │  │率       │ │程度     │ │度       │ │         │ │         │
│         │  │         │ │         │ │         │ │         │ │         │
│能力匹配 │  │性能指标 │ │竞争     │ │满意度   │ │复购率   │ │复购率   │
│度       │  │         │ │优势     │ │         │ │         │ │         │
└─────────┘  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘
      │            │          │          │          │          │
      ▼            ▼          ▼          ▼          ▼          ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          效率计算引擎                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  效率分数 = 产出量 / (投入量 × 处理时间)                                │
│  转化率 = 产出量 / 投入量                                               │
│  瓶颈识别 = 识别效率最低的环节                                          │
│  瓶颈影响 = 计算瓶颈对整体效率的影响程度                                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

## 🧮 Shapley归因算法流程图

```
渠道组合 → 贡献计算 → 权重计算 → Shapley值 → 归因结果
    │         │         │         │         │
    ▼         ▼         ▼         ▼         ▼
┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│社交媒体 │ │基础贡献 │ │组合权重 │ │Shapley  │ │归因排名 │
│搜索引擎 │ │协同效应 │ │1/(n×C)  │ │值计算   │ │         │
│邮件营销 │ │修正系数 │ │         │ │         │ │置信度   │
│直接访问 │ │         │ │         │ │         │ │         │
└─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘
    │         │         │         │         │
    ▼         ▼         ▼         ▼         ▼
┌─────────────────────────────────────────────────────────────┐
│                    Shapley算法核心                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  φᵢ = Σ [1/(n×C(n-1,|S|-1))] × [v(S) - v(S\{i})]         │
│                                                             │
│  其中：                                                     │
│  - φᵢ: 渠道i的Shapley值                                    │
│  - n: 总渠道数                                             │
│  - S: 包含渠道i的渠道组合                                  │
│  - v(S): 组合S的价值贡献                                   │
│  - C(n-1,|S|-1): 组合数                                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 🎯 决策管理流程图

```
战略层决策 → 战术层决策 → 执行层决策 → 执行动作 → 效果追踪
     │           │           │           │           │
     ▼           ▼           ▼           ▼           ▼
┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│董事会   │ │部门层   │ │团队层   │ │具体操作 │ │结果评估 │
│决策     │ │决策     │ │决策     │ │         │ │         │
│         │ │         │ │         │ │         │ │         │
│长期性   │ │中期性   │ │短期性   │ │采购单   │ │直接效果 │
│全局性   │ │部门性   │ │具体性   │ │生产工单 │ │间接效果 │
│方向性   │ │策略性   │ │操作性   │ │客户订单 │ │总体效果 │
└─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘
     │           │           │           │           │
     ▼           ▼           ▼           ▼           ▼
┌─────────────────────────────────────────────────────────────┐
│                    决策档案管理                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  决策ID: STR-产品特性-20250119-001                          │
│  意图: 建立技术领先优势，提升品牌竞争力                     │
│  量化目标: 市场份额提升至30%，品牌价值增长20%               │
│  关联链路: 核心资源→产品特性→价值主张→客户感知→体验价值→客户买单 │
│  执行关联: 绑定相关执行单据                                │
│  追溯分析: 全链路效果追踪                                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 技术架构组件图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Next.js全栈架构                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐                    ┌─────────────────┐                    │
│  │   前端组件      │                    │   后端API       │                    │
│  │                │                    │                │                    │
│  │ React组件      │◄─────────────────►│ API Routes     │                    │
│  │ TypeScript     │                    │ TypeScript     │                    │
│  │ Tailwind CSS   │                    │ 业务逻辑       │                    │
│  │ shadcn/ui      │                    │ 数据处理       │                    │
│  │ Recharts       │                    │ 算法调用       │                    │
│  └─────────────────┘                    └─────────────────┘                    │
│           │                                       │                            │
│           ▼                                       ▼                            │
│  ┌─────────────────┐                    ┌─────────────────┐                    │
│  │   状态管理      │                    │   数据库层      │                    │
│  │                │                    │                │                    │
│  │ TanStack Query │◄─────────────────►│ PostgreSQL     │                    │
│  │ 缓存管理       │                    │ Supabase       │                    │
│  │ 实时更新       │                    │ 实时订阅       │                    │
│  │ 错误处理       │                    │ 数据验证       │                    │
│  └─────────────────┘                    └─────────────────┘                    │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 📈 性能优化架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              性能优化策略                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│  │   查询优化      │    │   缓存策略      │    │   实时更新      │              │
│  │                │    │                │    │                │              │
│  │ 索引优化       │    │ 计算结果缓存    │    │ Supabase实时    │              │
│  │ 复合索引       │    │ 内存缓存       │    │ 订阅            │              │
│  │ 查询优化       │    │ TTL策略        │    │ 增量更新        │              │
│  │ 分区策略       │    │ 缓存失效       │    │ 事件驱动        │              │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘              │
│           │                       │                       │                    │
│           ▼                       ▼                       ▼                    │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│  │   计算优化      │    │   存储优化      │    │   网络优化      │              │
│  │                │    │                │    │                │              │
│  │ 算法优化       │    │ 数据压缩       │    │ CDN加速        │              │
│  │ 并行计算       │    │ 数据分区       │    │ 请求合并        │              │
│  │ 增量计算       │    │ 数据归档       │    │ 响应压缩        │              │
│  │ 结果复用       │    │ 数据清理       │    │ 连接池          │              │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘              │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🎯 系统集成架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                             系统集成架构                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐              │
│  │   Cursor        │    │   Lovable       │    │   外部系统      │              │
│  │                │    │                │    │                │              │
│  │ 需求梳理       │    │ 前端开发       │    │ 订单系统       │              │
│  │ 算法设计       │    │ 后端API        │    │ 客户系统       │              │
│  │ 架构设计       │    │ 数据库设计     │    │ 财务系统       │              │
│  │ 技术指导       │    │ UI/UX实现      │    │ 营销系统       │              │
│  │ 文档编写       │    │ 测试验证       │    │ 生产系统       │              │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘              │
│           │                       │                       │                    │
│           ▼                       ▼                       ▼                    │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                            GitHub仓库                                      │ │
│  │                                                                             │ │
│  │  https://github.com/billHuangFeng/bmos-insight                             │ │
│  │                                                                             │ │
│  │  - 需求文档 (Cursor)                                                        │ │
│  │  - 算法设计 (Cursor)                                                        │ │
│  │  - 前端代码 (Lovable)                                                       │ │
│  │  - 后端代码 (Lovable)                                                       │ │
│  │  - 数据库设计 (Lovable)                                                     │ │
│  │  - 配置文件 (共同维护)                                                      │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 📋 架构特点总结

### 1. **数据链特点**
- **完整性**: 覆盖从数据采集到决策应用的全链路
- **实时性**: 支持实时数据更新和计算
- **可追溯性**: 每个计算结果都可以追溯到原始数据
- **可扩展性**: 支持新数据源和计算逻辑的扩展

### 2. **计算逻辑特点**
- **科学性**: 基于Shapley算法等科学方法
- **准确性**: 高精度的数值计算和归因分析
- **实用性**: 生成可操作的优化建议
- **智能化**: 自动化的决策管理和效果追踪

### 3. **技术架构特点**
- **现代化**: Next.js + TypeScript + PostgreSQL
- **协同性**: Cursor和Lovable的完美分工
- **可维护性**: 清晰的模块划分和接口设计
- **高性能**: 优化的查询和缓存策略

### 4. **业务价值特点**
- **理论指导**: 基于完整的商业模式理论框架
- **数据驱动**: 全链路数据追溯和分析
- **决策支持**: 层级决策管理和效果评估
- **智能优化**: AI驱动的归因分析和优化建议

---

**这个架构图清晰展示了BMOS系统的完整数据链和计算逻辑，为系统的开发和维护提供了清晰的指导！** 🎉




