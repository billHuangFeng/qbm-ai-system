# å¤æ‚å•æ®å¯¼å…¥åˆ†å·¥ç­–ç•¥

**åˆ›å»ºæ—¶é—´**: 2025-01-23  
**ç‰ˆæœ¬**: 1.0  
**çŠ¶æ€**: âœ… **å·²ç¡®å®š**

---

## ğŸ“‹ æ ¸å¿ƒåŸåˆ™

å¤æ‚å•æ®å¯¼å…¥åŠŸèƒ½åº”é‡‡ç”¨ **"ç®—æ³•åœ¨åç«¯ï¼Œäº¤äº’åœ¨å‰ç«¯"** çš„æ··åˆæ¨¡å¼ï¼š

- **Cursor (FastAPI)**: å®ç°æ ¸å¿ƒç®—æ³•å’Œæ•°æ®å¤„ç†é€»è¾‘
- **Lovable (Edge Functions + Frontend)**: å®ç°ç”¨æˆ·äº¤äº’ç•Œé¢å’Œè½»é‡çº§ä¸šåŠ¡é€»è¾‘

---

## ğŸ¯ åˆ†å·¥å»ºè®®

### âœ… Cursor è´Ÿè´£ï¼ˆFastAPIåç«¯ï¼‰

#### 1. æ ¸å¿ƒç®—æ³•å®ç°

**æ ¼å¼è¯†åˆ«ç®—æ³•**
- âœ… æ–‡æ¡£æ ¼å¼è‡ªåŠ¨æ£€æµ‹ï¼ˆ6ç§æ ¼å¼è¯†åˆ«ï¼‰
- âœ… å­—æ®µç±»å‹å’Œç»“æ„åˆ†æ
- âœ… æ¨¡å¼åŒ¹é…å’Œç‰¹å¾æå–
- âœ… æ ¼å¼å¾—åˆ†è®¡ç®—

**å­—æ®µæ˜ å°„ç®—æ³•**
- âœ… æ™ºèƒ½å­—æ®µæ˜ å°„æ¨è
- âœ… å­—æ®µç›¸ä¼¼åº¦è®¡ç®—ï¼ˆLevenshteinè·ç¦»ã€è¯­ä¹‰ç›¸ä¼¼åº¦ï¼‰
- âœ… å­—æ®µæ˜ å°„è§„åˆ™å­¦ä¹ 
- âœ… ä½ç½®æ˜ å°„ï¼ˆæ— è¡¨å¤´æ–‡ä»¶ï¼‰

**ä¸»æ•°æ®åŒ¹é…ç®—æ³•**
- âœ… ä¸»æ•°æ®IDè‡ªåŠ¨åŒ¹é…ï¼ˆ7ç§ä¸»æ•°æ®ç±»å‹ï¼‰
- âœ… å•å­—æ®µå’Œç»„åˆå­—æ®µåŒ¹é…
- âœ… æ¨¡ç³ŠåŒ¹é…å’Œç²¾ç¡®åŒ¹é…
- âœ… ç½®ä¿¡åº¦è®¡ç®—
- âœ… åŒ¹é…ç»“æœæ’åºå’Œæ¨è

**å•æ®å¤´IDåŒ¹é…ç®—æ³•**
- âœ… é€šè¿‡å•æ®å·åŒ¹é…ç³»ç»Ÿä¸­å·²å­˜åœ¨çš„å•æ®å¤´è®°å½•ID
- âœ… åŒ¹é…ç»“æœéªŒè¯
- âœ… åŒ¹é…å»ºè®®ç”Ÿæˆ

**æ•°æ®å¤„ç†ç®—æ³•**
- âœ… å‰å‘å¡«å……ï¼ˆæ ¼å¼2ï¼‰
- âœ… æ•°æ®åˆå¹¶å’Œå…³è”
- âœ… è™šæ‹Ÿè®°å½•ç”Ÿæˆ
- âœ… æ•°æ®æ¸…æ´—å’Œè½¬æ¢

#### 2. æ•°æ®éªŒè¯é€»è¾‘

- âœ… å¿…å¡«å­—æ®µéªŒè¯ï¼ˆä¸¥æ ¼å¿…å¡« vs å¯è¡¥å……å¿…å¡«ï¼‰
- âœ… æ•°æ®è´¨é‡è¯„ä¼°
- âœ… é‡‘é¢å­—æ®µä¸€è‡´æ€§éªŒè¯ï¼ˆä»·ç¨åˆè®¡ = ä¸å«ç¨é‡‘é¢ + ç¨é¢ï¼‰
- âœ… ä¸šåŠ¡è§„åˆ™éªŒè¯

#### 3. APIç«¯ç‚¹

**æ ¸å¿ƒå¤„ç†ç«¯ç‚¹**
- `POST /api/v1/data-import/analyze` - åˆ†ææ–‡ä»¶ç»“æ„ï¼Œæ¨èå­—æ®µæ˜ å°„
- `POST /api/v1/data-import/process` - å¤„ç†å¤æ‚å•æ®æ ¼å¼
- `POST /api/v1/data-import/validate` - æ·±åº¦æ•°æ®éªŒè¯

**åŒ¹é…å’Œå†³ç­–ç«¯ç‚¹**
- `POST /api/v1/data-import/match-master-data` - ä¸»æ•°æ®åŒ¹é…ï¼ˆæ‰¹é‡ï¼‰
- `POST /api/v1/data-import/match-document-header` - å•æ®å¤´IDåŒ¹é…ï¼ˆæ ¼å¼5è¡¥å……æ˜ç»†æ—¶ï¼‰
- `POST /api/v1/data-import/match-status` - è·å–åŒ¹é…çŠ¶æ€å’Œå¾…å†³ç­–é¡¹

**ç”¨æˆ·å†³ç­–ç«¯ç‚¹**
- `POST /api/v1/data-import/confirm-match` - ç¡®è®¤åŒ¹é…å†³ç­–ï¼ˆé€‰æ‹©ã€åˆ›å»ºæ–°ã€åºŸå¼ƒï¼‰

---

### âœ… Lovable è´Ÿè´£ï¼ˆEdge Functions + Frontendï¼‰

#### 1. ç”¨æˆ·äº¤äº’ç•Œé¢

**å­—æ®µæ˜ å°„ç•Œé¢**
- âœ… å±•ç¤ºæºå­—æ®µå’Œç›®æ ‡å­—æ®µæ˜ å°„å…³ç³»
- âœ… ç”¨æˆ·æ‰‹åŠ¨è°ƒæ•´æ˜ å°„
- âœ… ç¡®è®¤æ˜ å°„ç»“æœ

**æ ¼å¼è¯†åˆ«å±•ç¤º**
- âœ… æ˜¾ç¤ºæ£€æµ‹åˆ°çš„æ ¼å¼ç±»å‹
- âœ… æ ¼å¼ç½®ä¿¡åº¦å±•ç¤º
- âœ… ç”¨æˆ·ç¡®è®¤æˆ–æ‰‹åŠ¨é€‰æ‹©æ ¼å¼

**åŒ¹é…å†³ç­–ç•Œé¢**
- âœ… ä¸»æ•°æ®åŒ¹é…ç»“æœå±•ç¤ºï¼ˆå¤šä¸ªå€™é€‰ï¼‰
- âœ… å•æ®å¤´åŒ¹é…ç»“æœå±•ç¤º
- âœ… ç”¨æˆ·é€‰æ‹©æ“ä½œï¼š
  - é€‰æ‹©æŸä¸ªåŒ¹é…é¡¹
  - åˆ›å»ºæ–°çš„ä¸»æ•°æ®/å•æ®å¤´
  - åºŸå¼ƒè¯¥æ¡è®°å½•
- âœ… æ‰¹é‡å†³ç­–æ”¯æŒ

**è¿›åº¦å’ŒçŠ¶æ€å±•ç¤º**
- âœ… å¯¼å…¥è¿›åº¦æ¡
- âœ… å¤„ç†çŠ¶æ€ï¼ˆåˆ†æä¸­ã€å¾…å†³ç­–ã€å¤„ç†ä¸­ã€å®Œæˆï¼‰
- âœ… é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯å±•ç¤º

#### 2. è½»é‡çº§ä¸šåŠ¡é€»è¾‘ï¼ˆEdge Functionsï¼‰

**ç®€å•éªŒè¯**
- âœ… æ–‡ä»¶æ ¼å¼åŸºç¡€éªŒè¯
- âœ… æ–‡ä»¶å¤§å°æ£€æŸ¥
- âœ… å¿…å¡«å‚æ•°éªŒè¯

**çŠ¶æ€ç®¡ç†**
- âœ… å¯¼å…¥æ‰¹æ¬¡åˆ›å»º
- âœ… å¯¼å…¥çŠ¶æ€æ›´æ–°
- âœ… ç”¨æˆ·å†³ç­–è®°å½•

**æ•°æ®å†™å…¥ï¼ˆç®€å•åœºæ™¯ï¼‰**
- âœ… ç®€å•CSV/JSONç›´æ¥å†™å…¥
- âœ… ç»è¿‡ç”¨æˆ·å†³ç­–åçš„æ•°æ®å†™å…¥

---

## ğŸ”„ åä½œæµç¨‹

### å…¸å‹å¯¼å…¥æµç¨‹

```
1. ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶
   â†“ (Lovable Frontend)
2. å‰ç«¯å‘é€æ–‡ä»¶åˆ° FastAPI
   â†“ (Cursor FastAPI)
3. FastAPI åˆ†ææ–‡ä»¶ç»“æ„
   - æ ¼å¼è¯†åˆ«
   - å­—æ®µæ˜ å°„æ¨è
   â†“ (è¿”å›åˆ†æç»“æœ)
4. Lovable Frontend å±•ç¤ºæ˜ å°„ç•Œé¢
   - ç”¨æˆ·ç¡®è®¤æˆ–è°ƒæ•´æ˜ å°„
   â†“ (ç”¨æˆ·ç¡®è®¤)
5. Lovable Frontend å‘é€æ˜ å°„é…ç½®åˆ° FastAPI
   â†“ (Cursor FastAPI)
6. FastAPI æ‰§è¡Œæ ¼å¼å¤„ç†å’Œå­—æ®µæ˜ å°„
   - è¯†åˆ«æ ¼å¼ç±»å‹
   - åº”ç”¨å­—æ®µæ˜ å°„
   - å¤„ç†æ ¼å¼ï¼ˆå‰å‘å¡«å……ã€åˆå¹¶ç­‰ï¼‰
   â†“ (å‘ç°éœ€è¦åŒ¹é…)
7. FastAPI æ‰§è¡Œä¸»æ•°æ®åŒ¹é…å’Œå•æ®å¤´åŒ¹é…
   - ç”ŸæˆåŒ¹é…ç»“æœå’Œå¾…å†³ç­–é¡¹
   â†“ (è¿”å›åŒ¹é…ç»“æœ)
8. Lovable Frontend å±•ç¤ºåŒ¹é…å†³ç­–ç•Œé¢
   - ä¸»æ•°æ®åŒ¹é…å€™é€‰åˆ—è¡¨
   - å•æ®å¤´åŒ¹é…ç»“æœ
   - ç”¨æˆ·è¿›è¡Œå†³ç­–
   â†“ (ç”¨æˆ·å†³ç­–å®Œæˆ)
9. Lovable Frontend å‘é€å†³ç­–ç»“æœåˆ° FastAPI
   â†“ (Cursor FastAPI)
10. FastAPI åº”ç”¨ç”¨æˆ·å†³ç­–ï¼Œå®Œæˆæ•°æ®å¤„ç†
    â†“ (è¿”å›å¤„ç†ç»“æœ)
11. Lovable Frontend å±•ç¤ºå¯¼å…¥ç»“æœ
    - æˆåŠŸ/å¤±è´¥ç»Ÿè®¡
    - é”™è¯¯å’Œè­¦å‘Š
    - å¯¼å…¥æŠ¥å‘Š
```

---

## ğŸ“Š æŠ€æœ¯è€ƒè™‘

### ä¸ºä»€ä¹ˆç®—æ³•åœ¨FastAPIï¼Ÿ

1. **è®¡ç®—å¤æ‚åº¦**
   - æ ¼å¼è¯†åˆ«éœ€è¦æ¨¡å¼åŒ¹é…å’Œç‰¹å¾åˆ†æ
   - å­—æ®µæ˜ å°„éœ€è¦ç›¸ä¼¼åº¦è®¡ç®—ç®—æ³•
   - ä¸»æ•°æ®åŒ¹é…éœ€è¦æ•°æ®åº“æŸ¥è¯¢å’Œæ¨¡ç³ŠåŒ¹é…
   - è¿™äº›ç®—æ³•å¤æ‚åº¦ > O(n)

2. **ä¾èµ–åº“**
   - pandas, numpyï¼ˆæ•°æ®å¤„ç†ï¼‰
   - python-Levenshteinï¼ˆå­—ç¬¦ä¸²ç›¸ä¼¼åº¦ï¼‰
   - å¯èƒ½éœ€è¦çš„MLåº“ï¼ˆè¯­ä¹‰ç›¸ä¼¼åº¦ï¼‰
   - PostgreSQLå®¢æˆ·ç«¯ï¼ˆä¸»æ•°æ®æŸ¥è¯¢ï¼‰

3. **æ‰§è¡Œæ—¶é—´**
   - å¤§æ–‡ä»¶æ ¼å¼åˆ†æå¯èƒ½éœ€è¦ > 10ç§’
   - æ‰¹é‡ä¸»æ•°æ®åŒ¹é…å¯èƒ½éœ€è¦ > 10ç§’

4. **æ•°æ®åº“è®¿é—®**
   - ä¸»æ•°æ®æŸ¥è¯¢éœ€è¦è¿æ¥PostgreSQL
   - å•æ®å¤´è®°å½•æŸ¥è¯¢éœ€è¦è¿æ¥æ•°æ®åº“
   - Edge Functionsä¸é€‚åˆé¢‘ç¹çš„å¤æ‚æ•°æ®åº“æŸ¥è¯¢

### ä¸ºä»€ä¹ˆäº¤äº’åœ¨Lovableï¼Ÿ

1. **ç”¨æˆ·ä½“éªŒ**
   - å‰ç«¯ç•Œé¢å“åº”é€Ÿåº¦å¿«
   - å®æ—¶å±•ç¤ºå¤„ç†è¿›åº¦
   - äº¤äº’å¼å†³ç­–ç•Œé¢

2. **è½»é‡çº§é€»è¾‘**
   - Edge Functionså¤„ç†ç®€å•éªŒè¯å’ŒçŠ¶æ€æ›´æ–°
   - å¿«é€Ÿå“åº”ï¼Œæ— éœ€å¤æ‚è®¡ç®—

3. **çŠ¶æ€ç®¡ç†**
   - å‰ç«¯ç®¡ç†ç”¨æˆ·äº¤äº’çŠ¶æ€
   - Edge Functionsç®¡ç†å¯¼å…¥æ‰¹æ¬¡çŠ¶æ€

---

## ğŸ“ APIæ¥å£è®¾è®¡

### 1. æ–‡ä»¶åˆ†ææ¥å£

```http
POST /api/v1/data-import/analyze
Content-Type: multipart/form-data

{
  "file": <file>,
  "source_type": "purchase_order|sales_order|..."
}
```

**å“åº”**:
```json
{
  "document_format": "excel",
  "detected_format_type": "repeated_header|first_row_header|...",
  "format_confidence": 0.95,
  "field_mappings": [
    {
      "source_field": "é‡‡è´­å•å·",
      "target_field": "å•æ®å·",
      "confidence": 0.98,
      "match_type": "exact|fuzzy|semantic"
    }
  ],
  "suggested_mappings": [...],
  "warnings": [...]
}
```

### 2. æ ¼å¼å¤„ç†æ¥å£

```http
POST /api/v1/data-import/process
Content-Type: application/json

{
  "file_id": "uuid",
  "field_mappings": {
    "æºå­—æ®µ1": "ç›®æ ‡å­—æ®µ1",
    ...
  },
  "format_type": "repeated_header|auto",
  "metadata": {...}
}
```

**å“åº”**:
```json
{
  "processing_id": "uuid",
  "status": "processing|requires_decision|completed",
  "processed_records": 100,
  "requires_decisions": {
    "master_data_matches": [...],
    "document_header_matches": [...]
  }
}
```

### 3. ä¸»æ•°æ®åŒ¹é…æ¥å£

```http
POST /api/v1/data-import/match-master-data
Content-Type: application/json

{
  "records": [
    {
      "row_index": 0,
      "master_data_type": "business_entity|product|...",
      "source_values": {
        "ç»è¥ä¸»ä½“åç§°": "XXXå…¬å¸",
        "ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ": "91110000..."
      }
    }
  ]
}
```

**å“åº”**:
```json
{
  "matches": [
    {
      "row_index": 0,
      "master_data_type": "business_entity",
      "candidates": [
        {
          "id": 123,
          "name": "XXXå…¬å¸",
          "confidence": 0.98,
          "match_fields": ["entity_name", "credit_code"]
        },
        {
          "id": 456,
          "name": "XXXå…¬å¸ï¼ˆç›¸ä¼¼ï¼‰",
          "confidence": 0.75,
          "match_fields": ["entity_name"]
        }
      ],
      "no_match": false,
      "multiple_matches": true
    }
  ]
}
```

### 4. å•æ®å¤´IDåŒ¹é…æ¥å£ï¼ˆæ ¼å¼5è¡¥å……æ˜ç»†ï¼‰

```http
POST /api/v1/data-import/match-document-header
Content-Type: application/json

{
  "document_numbers": ["DOC001", "DOC002", ...],
  "document_type": "purchase_order|sales_order|..."
}
```

**å“åº”**:
```json
{
  "matches": [
    {
      "document_number": "DOC001",
      "header_id": 789,
      "header_info": {
        "id": 789,
        "document_number": "DOC001",
        "document_date": "2024-01-01",
        "customer_name": "å®¢æˆ·A"
      },
      "confidence": 1.0,
      "found": true
    },
    {
      "document_number": "DOC999",
      "header_id": null,
      "header_info": null,
      "confidence": 0.0,
      "found": false,
      "message": "ç³»ç»Ÿä¸­æœªæ‰¾åˆ°å•æ®å·DOC999çš„å•æ®å¤´è®°å½•"
    }
  ],
  "unmatched_count": 1
}
```

### 5. ç”¨æˆ·å†³ç­–ç¡®è®¤æ¥å£

```http
POST /api/v1/data-import/confirm-match
Content-Type: application/json

{
  "processing_id": "uuid",
  "decisions": [
    {
      "type": "master_data|document_header",
      "row_index": 0,
      "decision": "select|create_new|skip",
      "selected_id": 123,  // é€‰æ‹©æŸä¸ªåŒ¹é…é¡¹æ—¶
      "new_data": {...},   // åˆ›å»ºæ–°è®°å½•æ—¶
      "reason": "ç”¨æˆ·é€‰æ‹©"
    }
  ]
}
```

**å“åº”**:
```json
{
  "success": true,
  "applied_decisions": 5,
  "updated_records": 100,
  "status": "processing|completed"
}
```

---

## âœ… æ€»ç»“

**æ ¸å¿ƒåˆ†å·¥**:
- **Cursor**: ç®—æ³•å®ç°ã€æ•°æ®å¤„ç†ã€åŒ¹é…é€»è¾‘ â†’ FastAPI
- **Lovable**: ç”¨æˆ·ç•Œé¢ã€äº¤äº’é€»è¾‘ã€çŠ¶æ€ç®¡ç† â†’ Frontend + Edge Functions

**ä¼˜åŠ¿**:
- âœ… ç®—æ³•é›†ä¸­ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤å’Œä¼˜åŒ–
- âœ… å‰ç«¯å“åº”å¿«ï¼Œç”¨æˆ·ä½“éªŒå¥½
- âœ… èŒè´£æ¸…æ™°ï¼Œæ˜“äºåä½œ
- âœ… æ”¯æŒå¤æ‚ç®—æ³•å’Œå¤§æ•°æ®å¤„ç†

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-01-23


